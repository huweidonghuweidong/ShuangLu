var anysign=anysign&&{logger:{openLog:false,e:function(message){if(anysign.logger.openLog){console.log("anysign error:"+message)}},w:function(message){if(anysign.logger.openLog){console.log("anysign warning:"+message)}}}};
var RESULT_OK=0;var RESULT_ERROR=-1;var EC_API_NOT_INITED=1;var EC_WRONG_CONTEXT_ID=2;var EC_NATIVE_EXCEPTION=3;var EC_TEMPLATE_NOT_SET=4;var EC_COMMENT_ALREADY_SHOW=5;var CALLBACK_TYPE_SIGNATURE=10;var CALLBACK_TYPE_DIALOG_CANCEL=11;var CALLBACK_TYPE_COMMENTSIGN=12;var CALLBACK_TYPE_GETVERSION=13;var CALLBACK_TYPE_START_RECORDING=14;var CALLBACK_TYPE_STOP_RECORDING=15;var isCommentShow=false;function anysignWebImpl(){var ContextID={FORMDATA_XML:10,FORMDATA_HTML:11,FORMDATA_PDF:12,FORMDATA_JSON:13,FORMDATA_PRESERVED:19};var isLock=false;var mCallback;var mIsInitialized=false;var mTemplateSet=false;var mTid;var mWONo;var mWOHash;var mChannel;var signData=[];var signObjArray=[];var soundObjArray=[];var photoObjArray=[];var mDatas=[];var mDataObjArray=[];var mCachetObjArray=[];var mPhotoEviCache;var mSoundEviCache;var mPhotoArrayCache=[];var mSoundArrayCache=[];var identifyCallBack;this._initAnySignApi=function(callback,channel){if(!callback||!channel){return false}_resetVariables();mCallback=callback;mChannel=channel;return true};this._addDataObj=function(context_id,dataConfig){if(!mIsInitialized&&_isDataObj(context_id)){dataConfig.cid=context_id;mDataObjArray[context_id]=dataConfig;var obj=new DataObj();obj.Format=dataConfig.format;obj.Name=dataConfig.name;obj.Cid=context_id;mDatas[context_id]=obj;return true}return false};this._addSignatureObj=function(context_id,signatureConfig){if(!mIsInitialized&&signatureConfig&&_isSigObj(context_id)){signatureConfig.cid=context_id;signObjArray[context_id]=signatureConfig;var holder=new SignatureObj();holder.Cid=context_id;holder.Signer=signatureConfig.signer;holder.SignRule=signatureConfig.signRule;holder.IsTSS=signatureConfig.isTSS;holder.TimeTag=signatureConfig.timeTag;signData[context_id]=holder;return true}return false};this._addCommentObj=function(context_id,signatureConfig){if(!mIsInitialized&&signatureConfig&&_isCommentObj(context_id)){signatureConfig.cid=context_id;signObjArray[context_id]=signatureConfig;var holder=new MassSignObj();
holder.Cid=context_id;holder.Signer=signatureConfig.signer;holder.SignRule=signatureConfig.signRule;holder.IsTSS=signatureConfig.isTSS;signData[context_id]=holder;return true}return false};this._addEvidenceHash=function(context_id,content,format,bioType,index){var holder=signData[context_id];if(!holder.Points){holder.Points=new PlainData()}if(!holder.Points.P10Data){holder.Points.P10Data=new P10Data()}if(!holder.Points.CertOID){holder.Points.CertOID=new CertOID()}if(!holder.Points.CertOID.BioFeature){holder.Points.CertOID.BioFeature=new BioFeature()}if(holder.Points.CertOID.BioFeature.Script){return false}if(bioType==BioType.PHOTO_SIGNER_IDENTITY_CARD_BACK||bioType==BioType.PHOTO_SIGNER_IDENTITY_CARD_FRONT){var photo=new PhotoEvidence();photo.Format=format;photo.Hash=content;photo.BioType=bioType;holder.Points.CertOID.BioFeature.PhotoArray[index]=photo;return true}if(bioType==BioType.SOUND_SIGNER_RETELL||bioType==BioType.SOUND_SIGNER_OTHER){var sound=new SoundEvidence();sound.Format=format;sound.Hash=content;sound.BioType=bioType;holder.Points.CertOID.BioFeature.SoundArray[index]=sound;return true}if(bioType==BioType.OTHER_TYPES_OF_EVIDENCE){var other=new OtherEvidence();other.Format=format;other.Hash=content;other.BioType=bioType;holder.Points.CertOID.BioFeature.OtherArray[index]=other;return true}return false};this._addEvidence=function(context_id,content,format,bioType,index){var holder=signData[context_id];if(!holder.Points){holder.Points=new PlainData()}if(!holder.Points.P10Data){holder.Points.P10Data=new P10Data()}if(!holder.Points.CertOID){holder.Points.CertOID=new CertOID()}if(!holder.Points.CertOID.BioFeature){holder.Points.CertOID.BioFeature=new BioFeature()}if(holder.Points.CertOID.BioFeature.Script){return false}if(bioType==BioType.PHOTO_SIGNER_IDENTITY_CARD_BACK||bioType==BioType.PHOTO_SIGNER_IDENTITY_CARD_FRONT){var photo=new PhotoEvidence();photo.Format=format;var mHash_photo=sha1Digest(content);photo.Hash="BS64:"+(mHash_photo.toString()).toUpperCase();
photo.BioType=bioType;holder.Points.CertOID.BioFeature.PhotoArray[index]=photo;return true}if(bioType==BioType.SOUND_SIGNER_RETELL||bioType==BioType.SOUND_SIGNER_OTHER){var sound=new SoundEvidence();sound.Format=format;var mHash_sound=sha1Digest(content);sound.Hash="BS64:"+(mHash_sound.toString()).toUpperCase();sound.BioType=bioType;holder.Points.CertOID.BioFeature.SoundArray[index]=sound;return true}return false};this._addEvidenceV2=function(context_id,content,bioType,index){var holder=signData[context_id];if(!holder.Points){holder.Points=new PlainData()}if(!holder.Points.P10Data){holder.Points.P10Data=new P10Data()}if(!holder.Points.CertOID){holder.Points.CertOID=new CertOID()}if(!holder.Points.CertOID.BioFeature){holder.Points.CertOID.BioFeature=new BioFeature()}if(holder.Points.CertOID.BioFeature.Script){return false}if(bioType==BioType.PHOTO_SIGNER_IDENTITY_CARD_BACK||bioType==BioType.PHOTO_SIGNER_IDENTITY_CARD_FRONT){var photo=new PhotoEvidence();photo.Format=DataFormat.IMAGE_JPEG;var mHash_photo=sha1Digest(content);photo.Hash="BS64:"+(mHash_photo.toString()).toUpperCase();photo.BioType=bioType;holder.Points.CertOID.BioFeature.PhotoArray[index]=photo;return true}if(bioType==BioType.SOUND_SIGNER_RETELL||bioType==BioType.SOUND_SIGNER_OTHER){var sound=new SoundEvidence();sound.Format=DataFormat.MEDIA_3GP;var mHash_sound=sha1Digest(content);sound.Hash="BS64:"+(mHash_sound.toString()).toUpperCase();sound.BioType=bioType;holder.Points.CertOID.BioFeature.SoundArray[index]=sound;return true}return false};this._addChachetObj=function(cachetConfig){if(!mIsInitialized&&cachetConfig){mCachetObjArray.push(cachetConfig);return true}return false};this._setTemplate=function(template_type,contentUtf8Str,businessId,template_serial){if(!mTemplateSet&&_isTemplate(template_type)){if(contentUtf8Str==null||contentUtf8Str.length===0){anysign.logger.e("contentUtf8Str must not be null or empty");return false}else{if(businessId==null||businessId.length===0){anysign.logger.e("businessId must not be null or empty");
return false}else{if(template_serial==null||template_serial.length===0){anysign.logger.e("template_serial must not be null or empty");return false}}}mWONo=businessId;mWOHash=sha1DigestBase64(businessId)+"";var obj=new DataObj();obj.Cid=template_type;obj.Data=contentUtf8Str;if(ContextID.FORMDATA_XML===template_type||ContextID.FORMDATA_JSON===template_type){var rule=new PDFCrdRule();rule.DocFormat=template_type;rule.DocStyleTid=template_serial;obj.PDFCrdRule=rule}var config=new DataConfig();config.cid=template_type;config.nessesary=true;mDatas[template_type]=obj;mDataObjArray[template_type]=config;mTemplateSet=true;return true}return false};this._setTID=function(tid){mTid=tid;return true};this._setData=function(cid,data){if(_getDataObj(cid)&&data){if(typeof data==="string"){var dataObj=mDatas[cid];dataObj.Data=Base64.encodeUint8Array(anysign.charset.strToUtf8ArrayUint8(data))}else{if(data instanceof Uint8Array){var dataObj=mDatas[cid];dataObj.Data=Base64.encodeUint8Array(data)}}return true}return false};this._commitConfig=function(){mIsInitialized=true;return true};this._resetConfig=function(){_resetVariables();return true};this._showSignatureDialog=function(context_id){if(!mIsInitialized){return EC_API_NOT_INITED}else{if(!mTemplateSet){return EC_TEMPLATE_NOT_SET}else{if(signObjArray[context_id]==null){return EC_WRONG_CONTEXT_ID}else{$("#btnOK").css("pointer-events","none");setTimeout(function(){$("#btnOK").css("pointer-events","auto")},400);$("#btnClear").css("pointer-events","none");setTimeout(function(){$("#btnClear").css("pointer-events","auto")},400);$("#btnCancel").css("pointer-events","none");setTimeout(function(){$("#btnCancel").css("pointer-events","auto")},400);$("#single_scrollbar_up").css("pointer-events","none");setTimeout(function(){$("#single_scrollbar_up").css("pointer-events","auto")},400);$("#single_scrollbar_down").css("pointer-events","none");setTimeout(function(){$("#single_scrollbar_down").css("pointer-events","auto")},400);onloadAnysignView(true,identifyCallBack);
var obj=signObjArray[context_id];var bh=getWindowHeight();var bw=getWindowWidth();var dlg=document.getElementById("dialog");dlg.style.height=bh;dlg.style.width=bw;dlg.style.display="block";var title=document.getElementById("anysign_title");var titleText=obj.title;var signer=titleText.substring(obj.titleSpanFromOffset,obj.titleSpanToOffset+1).big();title.innerHTML=titleText.substring(0,obj.titleSpanFromOffset)+signer+titleText.substring(obj.titleSpanToOffset+1,titleText.length);setSignResCallback(obj,function(cid,sourceData,data,trackData,trackPtCount,sigBoardWidth,sigBoardHeight){if(mCallback){if(data){var sigObj=signData[cid];_compressSigToHolder(sigObj,obj.penColor,trackData,trackPtCount,sigBoardWidth,sigBoardHeight);sigObj.ImageSize=new ImageSize(calculatedSigWidth,calculatedSigHeight);sigObj.Image=sourceData;if(sigObj.SignRule){if(sigObj.SignRule instanceof SignRule_XYZ){var xyzSub=sigObj.SignRule.XYZRule;if(xyzSub.Unit==="dp"){sigObj.SignRule.XYZRule={Left:xyzSub.Left,Top:xyzSub.Top,Right:xyzSub.Left+calculatedSigWidth,Bottom:xyzSub.Top-calculatedSigHeight,Pageno:xyzSub.Pageno,Unit:xyzSub.Unit}}else{if(xyzSub.Unit==="pt"){sigObj.SignRule.XYZRule={Left:xyzSub.Left,Top:xyzSub.Top,Right:xyzSub.Left+(calculatedSigWidth*0.45),Bottom:xyzSub.Top-(calculatedSigHeight*0.45),Pageno:xyzSub.Pageno,Unit:xyzSub.Unit}}}}}mCallback(obj.cid,CALLBACK_TYPE_SIGNATURE,data)}else{mCallback(obj.cid,CALLBACK_TYPE_DIALOG_CANCEL,null)}clear_canvas();var dlg=document.getElementById("dialog");dlg.style.display="none";setIsAnysignInputDlgShown(false)}});setIsAnysignInputDlgShown(true);return RESULT_OK}}}};this._showCommentDialog=function(context_id){if(!mIsInitialized){return EC_API_NOT_INITED}else{if(!mTemplateSet){return EC_TEMPLATE_NOT_SET}else{if(signObjArray[context_id]==null){return EC_WRONG_CONTEXT_ID}else{if(isCommentShow){return EC_COMMENT_ALREADY_SHOW}else{var obj=signObjArray[context_id];setSignResCallback(obj,function(cid,sourceData,data,trackData,trackPtCount,sigBoardWidth,sigBoardHeight){if(mCallback){if(data){var sigObj=signData[cid];
sigObj.ImageSize=new ImageSize(sigBoardWidth,sigBoardHeight);sigObj.Image=sourceData;if(sigObj.SignRule){if(sigObj.SignRule instanceof SignRule_XYZ){var xyzSub=sigObj.SignRule.XYZRule;if(xyzSub.Unit==="dp"){sigObj.SignRule.XYZRule={Left:xyzSub.Left,Top:xyzSub.Top,Right:xyzSub.Left+sigBoardWidth,Bottom:xyzSub.Top-sigBoardHeight,Pageno:xyzSub.Pageno,Unit:xyzSub.Unit}}else{if(xyzSub.Unit==="pt"){sigObj.SignRule.XYZRule={Left:xyzSub.Left,Top:xyzSub.Top,Right:xyzSub.Left+(sigBoardWidth*0.45),Bottom:xyzSub.Top-(sigBoardHeight*0.45),Pageno:xyzSub.Pageno,Unit:xyzSub.Unit}}}}}mCallback(obj.cid,CALLBACK_TYPE_COMMENTSIGN,data)}else{mCallback(obj.cid,CALLBACK_TYPE_DIALOG_CANCEL,null)}clear_canvas();var dlg=document.getElementById("dialog");dlg.style.display="none";setIsAnysignInputDlgShown(false)}});var commentUI=new anysignCommentUI();commentUI.onload_commentSignCanvas(obj,identifyCallBack);setIsAnysignInputDlgShown(true);return RESULT_OK}}}}};this._showGridCommentDialog=function(context_id){if(!mIsInitialized){return EC_API_NOT_INITED}else{if(!mTemplateSet){return EC_TEMPLATE_NOT_SET}else{if(signObjArray[context_id]==null){return EC_WRONG_CONTEXT_ID}else{if(isCommentShow){return EC_COMMENT_ALREADY_SHOW}else{var obj=signObjArray[context_id];setSignResCallback(obj,function(cid,sourceData,data,trackData,trackPtCount,sigBoardWidth,sigBoardHeight){if(mCallback){if(data){var sigObj=signData[cid];sigObj.ImageSize=new ImageSize(sigBoardWidth,sigBoardHeight);sigObj.Image=sourceData;if(sigObj.SignRule){if(sigObj.SignRule instanceof SignRule_XYZ){var xyzSub=sigObj.SignRule.XYZRule;if(xyzSub.Unit==="dp"){sigObj.SignRule.XYZRule={Left:xyzSub.Left,Top:xyzSub.Top,Right:xyzSub.Left+sigBoardWidth,Bottom:xyzSub.Top-sigBoardHeight,Pageno:xyzSub.Pageno,Unit:xyzSub.Unit}}else{if(xyzSub.Unit==="pt"){sigObj.SignRule.XYZRule={Left:xyzSub.Left,Top:xyzSub.Top,Right:xyzSub.Left+(sigBoardWidth*0.45),Bottom:xyzSub.Top-(sigBoardHeight*0.45),Pageno:xyzSub.Pageno,Unit:xyzSub.Unit}}}}}mCallback(obj.cid,CALLBACK_TYPE_COMMENTSIGN,data)
}else{mCallback(obj.cid,CALLBACK_TYPE_DIALOG_CANCEL,null)}clear_canvas();var dlg=document.getElementById("dialog");dlg.style.display="none";setIsAnysignInputDlgShown(false)}});var gridcommentUI=new gridCommentUI();gridcommentUI.onload_commentSignCanvas(obj,identifyCallBack);setIsAnysignInputDlgShown(true);return RESULT_OK}}}}};this._setIdentifyCallBack=function(callback){identifyCallBack=callback};this._startOCR=function(ocrCapture){var ocrObj=new OCRObj();ocrObj.setOCRCapture(ocrCapture)};this._takePicture=function(context_id){return false};this._picturePreview=function(context_id){return false};this._startMediaRecording=function(context_id){return false};this._audioPreview=function(context_id){return false};this._mediaPreview=function(context_id){return false};this._startMediaRecording=function(context_id){return false};this._finishMediaRecording=function(context_id){return false};this._isReadyToUpload=function(){if(!mIsInitialized||!mTemplateSet){return false}var isSignedAll=false;for(var key in signObjArray){var obj=signObjArray[key];var cid=obj.cid;var signObj=signData[cid];if(obj.nessesary){if(signObj==null){return false}else{if(isSignOrCom(signObj.Cid)){if(signObj.Points==null||signObj.Points.CertOID==null||signObj.Points.CertOID.BioFeature==null||signObj.Points.CertOID.BioFeature.Script==null){return false}}else{if(signObj.Image==null){return false}}}}if(isSignOrCom(signObj.Cid)){if(signObj.Points!=null&&signObj.Image!=null){isSignedAll=true}}if(!isSignedAll){return false}}for(key in mDataObjArray){var obj=mDataObjArray[key];var dataObj=mDatas[obj.cid];if((dataObj==null||dataObj.Data==null)&&obj.nessesary){return false}}return true};this._saveBusinessSession=function(encKey){encKey=md5Digest("424A4341"+encKey)+"";encKey=encKey.substring(0,24);var form=new SaveFormInfo();form.WONo=mWONo;form.WOHash=mWOHash;form.Channel=mChannel;var objLocal;for(var key in signObjArray){objLocal=signObjArray[key];form.USignConfigs.push(objLocal);form.USignObjs.push(signData[objLocal.cid])
}for(key in mDataObjArray){objLocal=mDataObjArray[key];form.DataConfigs.push(objLocal);form.DataObjs.push(mDatas[objLocal.cid])}form.CachetArray=mCachetObjArray;form.EncAlg=EncAlgType.EncAlg;var toEnc=anysign.json.stringify(form);var encData=tripleDesEncrypt(toEnc,encKey)+"";return encData};this._restoreBusinessSession=function(encData,desKey){desKey=md5Digest("424A4341"+desKey)+"";desKey=desKey.substring(0,24);var desDataHex=tripleDesDecrypt(encData,desKey)+"";var desDataStr=anysign.hex.hexStrToUint8Str(desDataHex);var restoreForm=anysign.json.stringToObj(desDataStr);mWONo=restoreForm.WONo;mWOHash=restoreForm.WOHash;mChannel=restoreForm.Channel;EncAlgType.EncAlg=restoreForm.EncAlg;var config_context_id;var obj_context_id;for(var signleConfigPos in restoreForm.USignConfigs){config_context_id=restoreForm.USignConfigs[signleConfigPos].cid;for(var signleObjPos in restoreForm.USignObjs){obj_context_id=restoreForm.USignObjs[signleObjPos].Cid;if(config_context_id==obj_context_id){signObjArray[config_context_id]=restoreForm.USignConfigs[signleConfigPos];signData[obj_context_id]=restoreForm.USignObjs[signleObjPos]}}}for(var signleConfigPos in restoreForm.DataConfigs){config_context_id=restoreForm.DataConfigs[signleConfigPos].cid;for(var signleObjPos in restoreForm.DataObjs){obj_context_id=restoreForm.DataObjs[signleObjPos].Cid;if(config_context_id==obj_context_id){mDataObjArray[config_context_id]=restoreForm.DataConfigs[signleConfigPos];mDatas[obj_context_id]=restoreForm.DataObjs[signleObjPos]}}}mCachetObjArray=restoreForm.CachetArray;mIsInitialized=true;mTemplateSet=true;return true};this._getUploadDataGram=function(){if(mIsInitialized&&this._isReadyToUpload()&&mTemplateSet){var root=new AnySignRoot();var form=new FormInfo();var random=new Uint8Array(24);if(window.crypto!=undefined){window.crypto.getRandomValues(random)}else{if(window.msCrypto!=undefined){window.msCrypto.getRandomValues(random)}else{capabal.crypto.getRandomValues(random)}}root.EncKey=rsaPubkeyUint8EncByDefault(random);
root.EncCertSN=encCertSN;var sigs=[];var objLocal;for(var key in signObjArray){objLocal=signObjArray[key];if(objLocal instanceof SignatureConfig||objLocal instanceof CommentConfig){if(signData[objLocal.cid].Image!=""&&signData[objLocal.cid].Image!=null){sigs.push(signData[objLocal.cid])}}}var datas=[];for(key in mDataObjArray){objLocal=mDataObjArray[key];if(objLocal instanceof DataConfig){datas.push(mDatas[objLocal.cid])}}form.WONo=mWONo;form.WOHash=mWOHash;form.Channel=mChannel;if(mCachetObjArray!=null&&mCachetObjArray.length>0){form.IsUnit=true}if(sigs==null||sigs.length==0){return null}form.USignArray=sigs;form.DataArray=datas;form.CachetArray=mCachetObjArray;form.ExtInfo=new ExtInfo();form.EncAlg=EncAlgType.EncAlg;var toEnc=anysign.json.stringify(form);root.EncData=tripleDesEncrypt(toEnc,anysign.hex.uint8ArrayToHexStr(random))+"";root.Digest=new Digest();root.Digest.Alg="CRC32";root.Digest.Value=anysign.digest.crc32(root.EncData).toString(16).toUpperCase();return anysign.json.stringify(root)}return null};this._getOSInfo=function(){if(isMobile.Android()){var userAgent=navigator.userAgent.toLowerCase();alert(userAgent);var startIndex=userAgent.indexOf("android");var endIndex=userAgent.indexOf(";",startIndex);startIndex+=8;var osStr=userAgent.substring(startIndex,endIndex);return("android##"+osStr)}else{if(isMobile.iOS()){var userAgent=navigator.userAgent;var startIndex;var endIndex;var osStr;if((startIndex=userAgent.indexOf("OS"))!=-1&&((endIndex=userAgent.indexOf("like Mac OS"))!=-1)){osStr=userAgent.substring(startIndex+3,endIndex-1);osStr=osStr.replace(/_/g,".");return("ios##"+osStr)}}}return"unknown"};function _resetVariables(){isLock=false;mCallback=null;mChannel=null;mIsInitialized=false;mTemplateSet=false;signData=[];signObjArray=[];mDatas=[];mCachetObjArray=[]}function _getDataObj(context_id){for(var key in mDataObjArray){var obj=mDataObjArray[key];if(obj&&obj.cid==context_id){return obj}}return null}function _compressSigToHolder(holder,penColor,trackData,trackPtCount,sigBoardWidth,sigBoardHeight){if(!holder.Points){holder.Points=new PlainData()
}if(!holder.Points.P10Data){holder.Points.P10Data=new P10Data()}if(!holder.Points.CertOID){holder.Points.CertOID=new CertOID()}if(!holder.Points.CertOID.BioFeature){holder.Points.CertOID.BioFeature=new BioFeature()}holder.Points.CertOID.IDNumber=holder.Signer.IDNumber;holder.Points.CertOID.IDType=holder.Signer.IDType;holder.Points.CertOID.BioFeature.Script=new Script();holder.Points.CertOID.ClientOS=new ClientOS();var script=holder.Points.CertOID.BioFeature.Script;script.Color=parseInt("0x"+penColor.substr(1))+"";script.Data=anysign.zip.compressToB64(anysign.charset.strToUint8ArrayAscII(trackData));script.Count=trackPtCount+"";script.Device=new Device();script.Device.Width=99999;script.Device.Height=99999;script.RefWidth=sigBoardWidth;script.RefHeight=sigBoardHeight}function _isTemplate(cid){if(ContextID.FORMDATA_XML<=cid&&cid<=ContextID.FORMDATA_PRESERVED){return true}else{return false}}function _isSigObj(cid){if(cid>=20&&cid<=29||cid>=200&&cid<=299){return true}else{return false}}function _isCommentObj(cid){if(cid>=30&&cid<=39||cid>=300&&cid<=399){return true}else{return false}}function _isDataObj(cid){if(cid>=50&&cid<=59||cid>=500&&cid<=599||_isTemplate(cid)){return true}else{return false}}}var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)?true:false},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)?true:false},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)?true:false},Windows:function(){return navigator.userAgent.match(/IEMobile/i)?true:false},any:function(){return(isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Windows())}};function onBridgeReady(){WeixinJSBridge.call("hideOptionMenu")}if(typeof WeixinJSBridge=="undefined"){if(document.addEventListener){document.addEventListener("WeixinJSBridgeReady",onBridgeReady,false)}else{if(document.attachEvent){document.attachEvent("WeixinJSBridgeReady",onBridgeReady);document.attachEvent("onWeixinJSBridgeReady",onBridgeReady)}}}else{onBridgeReady()
};
var AnySignRoot=function(){this.Version="4.7";this.EncCertSN=null;this.EncKey=null;this.TermSrc="PAD";this.Digest=null;this.EncData=null};var Digest=function(){this.Alg=null;this.Value=null};var FormInfo=function(){this.WONo=null;this.WOHash=null;this.IsSync=false;this.IsUnit=false;this.EncAlg="RSA";this.FlowID=null;this.Channel=null;this.USignArray=[];this.DataArray=[];this.CachetArray=[];this.ExtInfo=null};var SaveFormInfo=function(){this.WONo=null;this.WOHash=null;this.Channel=null;this.EncAlg="RSA";this.USignObjs=[];this.USignConfigs=[];this.DataObjs=[];this.DataConfigs=[];this.CachetArray=[]};var ExtInfo=function(){var Default1="1386655344912";var EMail=null};var PlainData=function(){this.P10Data=null;this.CertOID=null};var P10Data=function(){this.RawHash=null;this.Hash=null;this.Value=null;this.ValueType=null;this.P10SignValue=null;this.Hashalg=null;this.Dn=null;this.IDType=null;this.IDNumber=null;this.Templname="3";this.Channel="10000"};var CertOID=function(){this.Version="3.2";this.IDType=null;this.IDNumber=null;this.RawHash=null;this.BioFeature=null;this.ClientOS=null};var BioFeature=function(){this.PhotoArray=[];this.SoundArray=[];this.OtherArray=[];this.Script=null};var Script=function(){this.Format="zip";this.Width="180";this.Color=null;this.Count=null;this.Data=null;this.Device=null;this.RefHeight=99999;this.RefWidth=99999;this.Geoloca=null};var Device=function(){this.DeviceName="ANDROID_PAD_"+navigator.appName;this.SampleRate="1024";this.PressMax="1024";this.Width=99999;this.Height=99999;this.DriverVer="v1.0";this.DeviceID=navigator.appVersion;this.CertInfo=null};var ClientOS=function(){this.Name="WeiXin_"+navigator.platform;this.Edition=navigator.appCodeName;this.ServicePack="None";this.Version=navigator.appVersion;this.OSArch="32/64";this.DeviceID=navigator.appVersion};var ImageSize=function(width,height){this.Width=width;this.Height=height;this.Unit="dp"};var SignatureObj=function(){this.Cid=0;this.SignRule=null;this.Signer=null;this.Image=null;this.ImageSize=null;
this.IsTSS=false;this.Points=null;this.ImageFMT=DataFormat.IMAGE_PNG;this.TimeTag=null};var MassSignObj=function(){this.Cid=0;this.SignRule=null;this.Signer=null;this.Image=null;this.ImageSize=null;this.IsTSS=false;this.ImageFMT=DataFormat.IMAGE_PNG};var PhotoEvidence=function(){this.Format=null;this.Hash=null;this.BioType=null};var SoundEvidence=function(){this.Format=null;this.Hash=null;this.BioType=null};var OtherEvidence=function(){this.Format=null;this.Hash=null;this.BioType=null};var DataObj=function(){this.Cid=0;this.OwnerCid=0;this.PointHash=null;this.Data=null;this.Name=null;this.Format=null;this.PDFCrdRule=null};var PDFCrdRule=function(){this.DocCrdTid=null;this.DocFormat=null;this.DocStyleTid=null};var HWRRoot=function(){this.version="";this.transID=null;this.encKey=null;this.userID=null;this.serviceID=null;this.hwrInfo=null};var HWRInfo=function(){this.type=null;this.lang=Language.CHS;this.similar=100;this.strokes=[];this.text="";this.hwrNum=null};var HWRResult=function(){this.transID=null;this.result=[];this.errCode=null};
function ismobile(test){var u=navigator.userAgent,app=navigator.appVersion;if(/AppleWebKit.*Mobile/i.test(navigator.userAgent)||(/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent))){if(window.location.href.indexOf("?mobile")<0){try{if(/iPhone|mac|iPod|iPad/i.test(navigator.userAgent)){return"0"}else{return"1"}}catch(e){}}}else{if(u.indexOf("iPad")>-1){return"0"}else{return"1"}}}function IsPC(){var userAgentInfo=navigator.userAgent;var Agents=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];var flag=true;for(var v=0;v<Agents.length;v++){if(userAgentInfo.indexOf(Agents[v])>0){flag=false;break}}return flag}function getWindowWidth(){var winW=630,winH=460;if(document.body&&document.body.offsetWidth){winW=document.body.offsetWidth;winH=document.body.offsetHeight}if(document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){winW=document.documentElement.offsetWidth;winH=document.documentElement.offsetHeight}if(window.innerWidth&&window.innerHeight){winW=window.innerWidth;winH=window.innerHeight}return winW*0.99}function getWindowHeight(){var winW=630,winH=460;if(document.body&&document.body.offsetWidth){winW=document.body.offsetWidth;winH=document.body.offsetHeight}if(document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){winW=document.documentElement.offsetWidth;winH=document.documentElement.offsetHeight}if(window.innerWidth&&window.innerHeight){winW=window.innerWidth;winH=window.innerHeight}if(IsPC()){winH=winH*0.9}return winH*0.99}function isSignOrCom(cid){if(cid>=20&&cid<=29){return true}else{if(cid>=200&&cid<=299){return true}else{if(cid>=30&&cid<=39){return false}else{if(cid>=300&&cid<=399){return false}}}}return null}function checkText(text){var reg=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/;
if(reg.test(text)){return true}else{var a=[",",".","'",'"',";",":","?","/","","\\","","[","]","{","}","<",">","|","(",")","·"];var b=false;for(var i=0;i<a.length;i++){if(text==a[i]){b=true;return true}}return false}}function hideURLbar(){window.scrollTo(0,1)};
function gridCommentCore(inner_string,line_count,commentObjTmp,identify_callback){var base_stroke_width=(window.innerWidth>=480?15:10);base_stroke_width=10;var hw;var commentObjTmp1=commentObjTmp;var isDown=false;var isWriting=false;var distinguish=commentObjTmp.isdistinguish;var minX=9999,minY=9999,maxX=0,maxY=0;var curX=0,curY=0;var points=[];var points_all=[];var sbuilder=[];var sbuilder_arr=[];for(var i=0;i<commentObjTmp.commitment.length;i++){sbuilder_arr[i]=[]}var firstPointTime=0;var signTrack="";var signTrachPointCount=0;var paste_padding=10;var lastX=0,lastY=0;var comment_canvas;var tmp_ctx;var calculatedSigWidth=0;var calculatedSigHeight=0;var C_imageDataTmp;var itarget=10;var CurrentNum=0;var myImage=new Array();var timer=null;var signed_canvas_arr=[];var line_width=0;var row_height=0;var rowNum=0;var imgWidth;var imgHeight;var isPoint=false;var commentInner=inner_string.replace(/(.)(?=[^$])/g,"$1,").split(",");var comment_canvas=$(".grid_comment_canvas");var tmp_title=document.getElementById("comment_title");var tmp_signImage=document.getElementById("grid_signImage");var comment_ok=document.getElementById("grid_comment_ok");var comment_back=document.getElementById("comment_back");var comment_cancel=document.getElementById("grid_comment_cancel");var grid_scrollTop=document.getElementById("grid_scrollTop");var grid_scrollBottom=document.getElementById("grid_scrollBottom");var text=document.getElementById("signTitle");if(commentObjTmp.isShowBgText){text.innerHTML=commentInner[CurrentNum]}tmp_title.innerHTML=commentInner[0].replace(commentInner[0],'<font color="'+commentObjTmp.currentEditBarTextColor+'">$&</font>')+inner_string.substring(1,commentInner.length);var scaleFactor=window.devicePixelRatio?window.devicePixelRatio:1;$.each(comment_canvas,function(i,j){tmp_ctx=j.getContext("2d");tmp_ctx.strokeStyle=commentObjTmp.penColor;tmp_ctx.lineWidth=base_stroke_width;tmp_ctx.lineCap="round";tmp_ctx.lineJoin="round";tmp_ctx.shadowBlur=5});comment_ok.onclick=function(){comment_signConfirm()
};comment_back.onclick=function(){comment_backCanvas()};comment_cancel.onclick=function(){comment_cancelSign()};grid_scrollTop.onclick=function(){var grid_comment_content=document.getElementById("grid_comment_group");var grid_comment_canvas=document.getElementById("grid_comment_canvas");grid_comment_content.scrollTop+=grid_comment_canvas.offsetHeight*3};grid_scrollBottom.onclick=function(){var grid_comment_content=document.getElementById("grid_comment_group");var grid_comment_canvas=document.getElementById("grid_comment_canvas");grid_comment_content.scrollTop-=grid_comment_canvas.offsetHeight*3};$(".clear_canvas").click(function(){var that_ctx=$(this).prev()[0].getContext("2d");that_ctx.clearRect(0,0,$(this).prev()[0].width,$(this).prev()[0].height);var that_num=$(this).attr("canvas_num");signed_canvas_arr.splice(signed_canvas_arr.indexOf(that_num),1);sbuilder_arr[that_num]=[];isWriting=false});document.body.onselectstart=document.body.oncontextmenu=function(){return false};if("ontouchstart" in document.documentElement){var grid_comment_group=document.getElementById("grid_comment_group");if(window.attachEvent){grid_comment_group.addEventListener("ontouchstart",function(e){});grid_comment_group.addEventListener("ontouchmove",function(e){});grid_comment_group.addEventListener("ontouchend",function(e){})}else{grid_comment_group.addEventListener("touchstart",function(e){touchstart_fun(e)});grid_comment_group.addEventListener("touchmove",function(e){touchmove_fun(e)});grid_comment_group.addEventListener("touchend",function(e){touchend_fun(e)})}var prev_cenvas;var that_canvas;function touchstart_fun(e){that_canvas=e.target;if(timer!=null&&prev_cenvas==that_canvas){clearTimeout(timer)}isDown=true;isWriting=true}function touchmove_fun(e){if(isDown){comment_canvas=e.target;var canvas_num=comment_canvas.getAttribute("canvas_num");var offset=JQuery_Capable.offset(e.target);if(typeof e.targetTouches!=="undefined"){curX=Math.floor(e.targetTouches[0].pageX-offset.left);curY=Math.floor(e.targetTouches[0].pageY-offset.top)
}else{curX=Math.floor(e.pageX-offset.left);curY=Math.floor(e.pageY-offset.top)}var mill=e.timeStamp;if(signTrachPointCount===0&&!isNaN(mill)){firstPointTime=mill}if(curX>0&&curY<=comment_canvas.height){if(!isNaN(mill)){signTrack+=(curX+","+curY+","+base_stroke_width+","+(mill-firstPointTime)+"\n")}else{signTrack+=(curX+","+curY+","+base_stroke_width+","+0+"\n")}signTrachPointCount+=1;if(curX>maxX){maxX=curX}if(curX<minX){minX=curX}if(curY>maxY){maxY=curY}if(curY<minY){minY=curY}points.push({x:curX,y:curY});onCommentPaint(e.target);points_all.push({x:curX,y:curY});if(curX>0&&curY>0){sbuilder.push(curX,curY);sbuilder_arr[canvas_num].push(curX,curY)}lastX=curX;lastY=curY}preventDefault(e)}}function touchend_fun(e){var canvas_num=e.target.getAttribute("canvas_num");prev_cenvas=e.target;if(isDown){var mill=e.timeStamp;if(!isNaN(mill)){signTrack+=("0,0,"+-1+","+(mill-firstPointTime)+"\n")}else{signTrack+=("0,0,"+-1+","+0+"\n")}signTrachPointCount+=1;sbuilder.push("-1","0");sbuilder_arr[canvas_num].push("-1","0");var canvas=e.target;var text=document.getElementById("signTitle");if(CurrentNum>=commentInner.length){alert("抄录已完成！");text.innerHTML="";isWriting=false;tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height)}else{if(isPoint){isPoint=false;timer=setTimeout(function(){sbuilder.push("-1","-1");sbuilder_arr[canvas_num].push("-1","-1");if(distinguish&&!checkText(commentInner[CurrentNum])){var callback_dis=function(errCode,isEquals){closeWindow();if(errCode==0){if(isEquals){if(signed_canvas_arr.indexOf(canvas_num)==-1){signed_canvas_arr.push(canvas_num)}if(signed_canvas_arr.length==commentInner.length){getAllImg()}if(commentObjTmp1.isShowBgText){text.innerHTML=commentInner[CurrentNum]}minX=9999,minY=9999,maxX=0,maxY=0;sbuilder=[]}}else{tmp_ctx=e.target.getContext("2d");tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);minX=9999,minY=9999,maxX=0,maxY=0;sbuilder=[];sbuilder_arr[canvas_num]=[]}if(identify_callback==null){console.log("the identify callback is not definition")
}else{if(errCode!="请求超时"){identify_callback(errCode)}}};var ocrObj=new OCRObj(commentObjTmp1.ocrCapture);ocrObj.recognition(sbuilder_arr[canvas_num],commentInner[canvas_num],callback_dis);isWriting=false}else{if(signed_canvas_arr.indexOf(canvas_num)==-1){signed_canvas_arr.push(canvas_num)}if(signed_canvas_arr.length==commentInner.length){getAllImg()}if(commentObjTmp1.isShowBgText){text.innerHTML=commentInner[CurrentNum]}minX=9999,minY=9999,maxX=0,maxY=0;sbuilder=[];minX=9999,minY=9999,maxX=0,maxY=0;signData=null;isWriting=false;clearInterval(timer)}},1000)}}}isDown=false;points=[];points_all=[]}comment_canvas.ontouchcancel=comment_canvas.ontouchend}else{var grid_comment_group=document.getElementById("grid_comment_group");if(window.attachEvent){grid_comment_group.addEventListener("onmousedown",function(e){mousedown_fun(e)});grid_comment_group.addEventListener("onmousemove",function(e){mousemove_fun(e)});grid_comment_group.addEventListener("onmouseup",function(e){mouseup_fun(e)})}else{grid_comment_group.addEventListener("mousedown",function(e){mousedown_fun(e)});grid_comment_group.addEventListener("mousemove",function(e){mousemove_fun(e)});grid_comment_group.addEventListener("mouseup",function(e){mouseup_fun(e)})}var prev_cenvas;var that_canvas;var that_event;var prev_event;function mousedown_fun(e){that_canvas=e.target;that_event=e;if(timer!=null&&prev_cenvas==that_canvas){clearTimeout(timer)}isDown=true;isWriting=true}function mousemove_fun(e){comment_canvas=e.target;var canvas_num=comment_canvas.getAttribute("canvas_num");if(isDown){if(that_canvas!=e.target){mouseup_fun(that_event);return}var offset=JQuery_Capable.offset(e.target);var windowScrollOffsetTop=document.body.scrollTop|document.documentElement.scrollTop;var windowScrollOffsetLeft=document.body.scrollLeft|document.documentElement.scrollLeft;if(typeof e.targetTouches!=="undefined"){curX=Math.floor(e.targetTouches[0].clientX-offset.left);curY=Math.floor(e.targetTouches[0].clientY-offset.top)}else{curX=Math.floor(e.clientX-offset.left);
curY=Math.floor(e.clientY-offset.top)}var mill=e.timeStamp;if(signTrachPointCount===0&&!isNaN(mill)){firstPointTime=mill}if(curX>0){if(!isNaN(mill)){signTrack+=(curX+","+curY+","+base_stroke_width+","+(mill-firstPointTime)+"\n")}else{signTrack+=(curX+","+curY+","+base_stroke_width+","+0+"\n")}signTrachPointCount+=1;curY+=windowScrollOffsetTop;curX+=windowScrollOffsetLeft;if(curX>maxX){maxX=curX}if(curX<minX){minX=curX}if(curY>maxY){maxY=curY}if(curY<minY){minY=curY}points.push({x:curX,y:curY});onCommentPaint(e.target);points_all.push({x:curX,y:curY});if(curX>0&&curY>0){sbuilder.push(curX,curY);sbuilder_arr[canvas_num].push(curX,curY)}lastX=curX;lastY=curY}preventDefault(e)}}function mouseup_fun(e){if(isDown){var comment_canvas=e.target;var canvas_num=e.target.getAttribute("canvas_num");prev_cenvas=e.target;prev_event=e;isDown=false;var offset=JQuery_Capable.offset(e.target);if(typeof e.targetTouches!=="undefined"){curX=Math.floor(e.targetTouches[0].clientX-offset.left);curY=Math.floor(e.targetTouches[0].clientY-offset.top)}else{curX=Math.floor(e.clientX-offset.left);curY=Math.floor(e.clientY-offset.top)}var mill=e.timeStamp;if(!isNaN(mill)){signTrack+=("0,0,"+-1+","+(mill-firstPointTime)+"\n")}else{signTrack+=("0,0,"+-1+","+0+"\n")}signTrachPointCount+=1;sbuilder.push("-1","0");sbuilder_arr[canvas_num].push("-1","0");var canvas=e.target;var text=document.getElementById("signTitle");if(CurrentNum>=commentInner.length){alert("抄录已完成！");text.innerHTML="";tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);isWriting=false}else{timer=setTimeout(function(){sbuilder.push("-1","-1");sbuilder_arr[canvas_num].push("-1","-1");if(distinguish&&!checkText(commentInner[CurrentNum])){var callback_dis=function(errCode,isEquals){closeWindow();if(errCode==0){if(isEquals){if(signed_canvas_arr.indexOf(canvas_num)==-1){signed_canvas_arr.push(canvas_num)}if(signed_canvas_arr.length==commentInner.length){getAllImg()}if(commentObjTmp1.isShowBgText){text.innerHTML=commentInner[CurrentNum]
}minX=9999,minY=9999,maxX=0,maxY=0;sbuilder=[]}}else{tmp_ctx=e.target.getContext("2d");tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);minX=9999,minY=9999,maxX=0,maxY=0;sbuilder=[];sbuilder_arr[canvas_num]=[]}if(identify_callback==null){console.log("the identify callback is not definition")}else{if(errCode!="请求超时"){identify_callback(errCode)}}};var ocrObj=new OCRObj(commentObjTmp1.ocrCapture);ocrObj.recognition(sbuilder_arr[canvas_num],commentInner[canvas_num],callback_dis);isWriting=false}else{function signCanvas(){if(signed_canvas_arr.indexOf(canvas_num)==-1){signed_canvas_arr.push(canvas_num)}if(signed_canvas_arr.length==commentInner.length){getAllImg()}if(commentObjTmp1.isShowBgText){text.innerHTML=commentInner[CurrentNum]}minX=9999,minY=9999,maxX=0,maxY=0;sbuilder=[];signData=null;isWriting=false}setTimeout(function(){signCanvas()},100)}},1000)}isDown=false;points=[];points_all=[]}}var grid_comment_canvas=document.getElementsByClassName("grid_comment_canvas");for(var i=0;i<grid_comment_canvas.length;i++){grid_comment_canvas[i].onmouseout=function(){mouseup_fun(that_event)}}comment_canvas.onmouseout=comment_canvas.onmouseup}function getCommentSigData(){if(C_imageDataTmp){var tmp_canvas=document.createElement("canvas");var ctx=tmp_canvas.getContext("2d");var scaleFactor=window.devicePixelRatio?window.devicePixelRatio:1;tmp_canvas.width=C_imageDataTmp.width/scaleFactor;tmp_canvas.height=C_imageDataTmp.height/scaleFactor;var scaleFactor2=1;if(commentObjTmp1.mass_word_width/commentObjTmp1.mass_word_height<=tmp_canvas.width/tmp_canvas.height){if(commentObjTmp1.mass_word_width<=tmp_canvas.width){scaleFactor2=commentObjTmp1.mass_word_width/tmp_canvas.width}}else{if(commentObjTmp1.singleHeight<=tmp_canvas.height){scaleFactor2=commentObjTmp1.mass_word_height/tmp_canvas.height}}tmp_canvas.width*=scaleFactor2;tmp_canvas.height*=scaleFactor2;calculatedSigWidth=tmp_canvas.width;calculatedSigHeight=tmp_canvas.height;ctx.scale(1/scaleFactor*scaleFactor2,1/scaleFactor*scaleFactor2);
var data_canvas=document.createElement("canvas");data_canvas.width=C_imageDataTmp.width;data_canvas.height=C_imageDataTmp.height;data_canvas.getContext("2d").putImageData(C_imageDataTmp,0,0);ctx.drawImage(data_canvas,0,0);var compressSignData=tmp_canvas.toDataURL();return compressSignData}return null}var onCommentPaint=function(this_canvas){if(this_canvas.tagName=="CANVAS"){tmp_ctx=this_canvas.getContext("2d");if(points.length<3){var b=points[0];tmp_ctx.beginPath();tmp_ctx.strokeStyle=commentObjTmp1.penColor;tmp_ctx.fillStyle=commentObjTmp1.penColor;tmp_ctx.lineWidth=base_stroke_width;tmp_ctx.arc(b.x,b.y,tmp_ctx.lineWidth/2,0,Math.PI*2,!0);tmp_ctx.fill();tmp_ctx.closePath();isPoint=true;return}tmp_ctx.clearRect(0,0,tmp_ctx.width,tmp_ctx.height);tmp_ctx.beginPath();tmp_ctx.strokeStyle=commentObjTmp1.penColor;tmp_ctx.fillStyle=commentObjTmp1.penColor;tmp_ctx.moveTo(points[0].x,points[0].y);for(var i=1;i<points.length-2;i++){var c=(points[i].x+points[i+1].x)/2;var d=(points[i].y+points[i+1].y)/2;tmp_ctx.quadraticCurveTo(points[i].x,points[i].y,c,d)}tmp_ctx.stroke();isPoint=true}};function comment_backCanvas(){if(isWriting){return}if(CurrentNum<=0){alert("已移除完，请重新进行签名！");line_width=0}else{var image=document.getElementById("img"+CurrentNum);var tmp_signImage=document.getElementById("grid_signImage");tmp_signImage.removeChild(image);CurrentNum--;rowNum--;var text=document.getElementById("signTitle");if(commentObjTmp1.isShowBgText){text.innerHTML=commentInner[CurrentNum]}if(CurrentNum==0){line_width=0;rowNum=0}else{if(rowNum-1<0){rowNum=line_count;if(row_height>0){row_height--}line_width=0}else{line_width=rowNum*commentObjTmp1.mass_word_width}}var tmp_title=document.getElementById("comment_title");tmp_title.innerHTML=inner_string;tmp_title.style.color="black";tmp_title.innerHTML=inner_string.substring(0,CurrentNum)+commentInner[CurrentNum].replace(commentInner[CurrentNum],'<font color="'+commentObjTmp1.currentEditBarTextColor+'">$&</font>')+inner_string.substring(CurrentNum+1,commentInner.length)
}}function comment_cancelSign(){document.documentElement.style.overflow="auto";if(signResCallback){signResCallback(commentObjTmp1.cid,null,null,0)}clear_all()}function check_canvas(){if(signed_canvas_arr.length!=commentObjTmp1.commitment.length){return false}}function getAllImg(){for(var i=0;i<commentObjTmp1.commitment.length;i++){var all_canvas=document.getElementsByClassName("grid_comment_canvas");this_canvas=all_canvas[i];this_ctx=this_canvas.getContext("2d");var image=document.createElement("img");image.id="img"+i;image.width=commentObjTmp1.mass_word_width;image.height=commentObjTmp1.mass_word_height;if(true){image.src=this_canvas.toDataURL("image/png")}else{var width=maxX-minX;var height=maxY-minY;var cx=(maxX+minX)/2;var cy=(maxY+minY)/2;var radius;if(width<20&&height<20){radius=commentObjTmp1.mass_word_width}else{if(width>height){radius=width/2}else{radius=height/2}}C_imageDataTmp=comment_canvas.getContext("2d").getImageData(cx-radius-paste_padding,cy-radius-paste_padding,(radius+paste_padding)*2,(radius+paste_padding)*2);var signData=getCommentSigData();image.src=signData}myImage[i]=image;tmp_signImage.appendChild(image);tmp_signImage.scrollTop=tmp_signImage.scrollHeight}}function comment_signConfirm(){if(isWriting){return}if(distinguish){if(signed_canvas_arr.length!=commentObjTmp1.commitment.length){custom_alert("请完成签名","确认");return}}else{for(var i=0;i<commentObjTmp1.commitment.length;i++){if(sbuilder_arr[i].length==0||sbuilder_arr[i].length==2){custom_alert("请完成签名","确认");return}}}getAllImg();setTimeout(function(){draw();if(signResCallback){signResCallback(commentObjTmp1.cid,base64[0].substring(22,base64[0].length),base64[0].substring(22,base64[0].length),signTrack,signTrachPointCount,imgWidth,imgHeight)}clear_all()},100)}function clear_all(){var dlg=document.getElementById("grid_comment_dialog");dlg.style.display="none";minX=9999,minY=9999,maxX=0,maxY=0;document.body.parentNode.style.overflow="scroll";$(".grid_tmpcanvascss").remove();var commentSign=document.getElementById("comment_sign");
var tmp_textView=document.getElementById("comment_title");tmp_textView.innerHTML="";tmp_textView.style.color="black";var tmp_text=document.getElementById("signTitle");tmp_text.innerHTML="";for(var i=0;i<myImage.length;i++){tmp_signImage.removeChild(myImage[i])}commentObjTmp=null}function clear_gridCanvas(){var dlg=document.getElementById("grid_comment_dialog");minX=9999,minY=9999,maxX=0,maxY=0;sbuilder_arr=[];myImage=new Array();for(var i=0;i<commentObjTmp.commitment.length;i++){sbuilder_arr[i]=[]}signed_canvas_arr=[];document.body.parentNode.style.overflow="scroll";var commentSign=document.getElementById("comment_sign");var tmp_textView=document.getElementById("comment_title");tmp_textView.innerHTML="";tmp_textView.style.color="black";var tmp_text=document.getElementById("signTitle");tmp_text.innerHTML="";if(myImage.length>0){for(var i=0;i<myImage.length;i++){tmp_signImage.removeChild(myImage[i])}}}var grid_fresh=function(){clear_gridCanvas()};window.addEventListener("orientationchange",grid_fresh);window.addEventListener("resize",grid_fresh);var base64=[];function draw(){var c=document.createElement("canvas"),ctx=c.getContext("2d"),len=commentObjTmp1.mass_words_in_single_line;imgWidth=commentObjTmp1.mass_word_width*len;imgHeight=commentObjTmp1.mass_word_height*(inner_string.length/commentObjTmp1.mass_words_in_single_line+1);c.width=imgWidth;c.height=imgHeight;ctx.rect(0,0,c.width,c.height);ctx.fillStyle="#fff";ctx.fill();var w=0;var h=0;var allNum=commentInner.length;function drawing(n){if(n<allNum){if(w>=commentObjTmp1.mass_words_in_single_line){h=h+commentObjTmp1.mass_word_height;w=0}ctx.drawImage(myImage[n],commentObjTmp1.mass_word_width*w,h,commentObjTmp1.mass_word_width,commentObjTmp1.mass_word_height);w++;drawing(n+1)}else{base64.push(c.toDataURL("image/png",1))}}drawing(0)}function setSignResCallback(signObj,callback){if(isSignOrCom(signObj.cid)){signObjTmp=signObj;signResCallback=callback;var canvas=document.getElementById("anysignCanvas");var ctx=canvas.getContext("2d");
ctx.strokeStyle=signObjTmp?signObjTmp.penColor:"black"}else{commentObjTmp=signObj;signResCallback=callback;var canvas=document.getElementById("comment_canvas");var ctx=canvas.getContext("2d");ctx.strokeStyle=commentObjTmp1.penColor;comment_canvas.strokeStyle=commentObjTmp1.penColor}}window.addEventListener("resize",function(){if(timer!=null){clearInterval(timer)}var text=document.getElementById("signTitle");tmp_title.innerHTML=inner_string.substring(0,CurrentNum)+commentInner[CurrentNum].replace(commentInner[CurrentNum],'<font color="'+commentObjTmp1.currentEditBarTextColor+'">$&</font>')+inner_string.substring(CurrentNum+1,commentInner.length);if(commentObjTmp1.isShowBgText){if(CurrentNum>=commentInner.length){text.innerHTML=""}else{text.innerHTML=commentInner[CurrentNum]}}tmp_ctx.strokeStyle=commentObjTmp1.penColor;tmp_ctx.lineWidth=base_stroke_width;tmp_ctx.lineCap="round";tmp_ctx.lineJoin="round";tmp_ctx.shadowBlur=5});window.addEventListener("orientationchange",function(){if(timer!=null){clearInterval(timer)}var text=document.getElementById("signTitle");tmp_title.innerHTML=inner_string.substring(0,CurrentNum)+commentInner[CurrentNum].replace(commentInner[CurrentNum],'<font color="'+commentObjTmp1.currentEditBarTextColor+'">$&</font>')+inner_string.substring(CurrentNum+1,commentInner.length);tmp_ctx.strokeStyle=commentObjTmp1.penColor;tmp_ctx.lineWidth=base_stroke_width;tmp_ctx.lineCap="round";tmp_ctx.lineJoin="round";tmp_ctx.shadowBlur=5})};
function OCRObj(ocr){var ocrCapture;var hwrRoot;var hwrInfo;var callback_dis;var isEquals=false;if(ocr==null){ocrCapture=new OCRCapture()}else{ocrCapture=ocr}hwrRoot=new HWRRoot();hwrInfo=new HWRInfo();hwrRoot.version="1.0";hwrRoot.transID=UUID();hwrRoot.encKey="encKey";if(ocrCapture.appID==null||ocrCapture.appID==""||ocrCapture.appID==undefined){console.log("ocrCapture.appID is null");return}hwrRoot.userID=ocrCapture.appID;if(ocrCapture.serviceID==null||ocrCapture.serviceID==""||ocrCapture.serviceID==undefined){console.log("ocrCapture.serviceID is null");return}hwrRoot.serviceID=ocrCapture.serviceID;hwrInfo.type=1;if(ocrCapture.language==Language.CHS){hwrInfo.lang="1"}else{if(ocrCapture.language==Language.CHT){hwrInfo.lang="2"}}hwrInfo.similar=ocrCapture.resolution;hwrInfo.text=ocrCapture.text;hwrInfo.hwrNum=ocrCapture.count;hwrRoot.hwrInfo=hwrInfo;this.recognition=function(sbuilder,hitString,call_back){if(sbuilder==null||sbuilder==""||sbuilder==undefined){return"Identification parameter is empty"}if(sbuilder.length<10){return"too few coordinates"}callback_dis=call_back;OCRObj();if(hwrInfo!=null){hwrInfo.strokes=sbuilder;hwrInfo.hwrNum=ocrCapture.count;hwrRoot.hwrInfo=hwrInfo}if(ocrCapture.IPAdress==null||ocrCapture.IPAdress==""||ocrCapture.IPAdress==undefined){callback_dis("服务器地址为空！",isEquals);return}jQuery.ajax({type:"POST",data:JSON.stringify(hwrRoot),dataType:"text",timeout:5000,url:ocrCapture.IPAdress,success:function(data){if(data==null||data=="undefined"||data==""){callback_dis("链接服务器异常,请检查网络！",isEquals)}else{var result=JSON.parse(data);if(result==null||typeof(result)=="undefined"){alert("服务器连接失败,请稍后再次尝试")}else{if(result.errCode=="0"){var results=result.result;var returnText="";for(var i=0;i<results.length;i++){if(results[i]=="0"){if(hitString==returnText){isEquals=true;break}returnText=""}else{var charValue=String.fromCharCode(results[i]);returnText+=charValue}}}}if(result.errCode==0&&!isEquals){callback_dis("-1",isEquals)}else{callback_dis(result.errCode,isEquals)
}}},error:function(XMLHttpRequest,textStatus,errorThrown){callback_dis("请求超时",isEquals);if(textStatus=="timeout"){alert("请求超时,请稍后再次尝试");return}alert("连接服务端异常: "+textStatus+"；status code："+XMLHttpRequest.status+"；state："+XMLHttpRequest.readyState);var comment_canvas=document.getElementById("comment_canvas");var tmp_ctx=comment_canvas.getContext("2d");tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);return false}})}}function UUID(){var s=[];var hexDigits="0123456789abcdef";for(var i=0;i<36;i++){s[i]=hexDigits.substr(Math.floor(Math.random()*16),1)}s[14]="4";s[19]=hexDigits.substr((s[19]&3)|8,1);s[8]=s[13]=s[18]=s[23]="-";var uuid=s.join("");return uuid}function stringToBytes(str){var ch,st,re=[];for(var i=0;i<str.length;i++){ch=str.charCodeAt(i);st=[];do{st.push(ch&255);ch=ch>>8}while(ch);re=re.concat(st.reverse())}return re};
function anysignCommentCore(inner_string,line_count,commentObjTmp,identify_callback){var base_stroke_width=(window.innerWidth>=480?15:10);var hw;var isDown=false;var isWriting=false;var minX=9999,minY=9999,maxX=0,maxY=0;var curX=0,curY=0;var points=[];var points_all=[];var sbuilder=[];var firstPointTime=0;var signTrack="";var signTrachPointCount=0;var paste_padding=10;var lastX=0,lastY=0;var comment_canvas;var tmp_ctx;var calculatedSigWidth=0;var calculatedSigHeight=0;var C_imageDataTmp;var itarget=10;var CurrentNum=0;var myImage=new Array();var timer=null;var line_width=0;var row_height=0;var rowNum=0;var imgWidth;var imgHeight;var isPoint=false;var commentInner=inner_string.replace(/(.)(?=[^$])/g,"$1,").split(",");var comment_canvas=document.getElementById("comment_canvas");var tmp_title=document.getElementById("comment_title");var tmp_signImage=document.getElementById("signImage");var comment_ok=document.getElementById("comment_ok");var comment_back=document.getElementById("comment_back");var comment_cancel=document.getElementById("comment_cancel");var sign_last_text=0;tmp_ctx=comment_canvas.getContext("2d");var text=document.getElementById("signTitle");if(commentObjTmp.isShowBgText){text.innerHTML=commentInner[CurrentNum]}tmp_title.innerHTML=commentInner[0].replace(commentInner[0],'<font color="'+commentObjTmp.currentEditBarTextColor+'">$&</font>')+inner_string.substring(1,commentInner.length);var inner_text="";for(var i=0;i<inner_string.length;i++){if(i==0){inner_text+="<font class='mass_anysign_p select_p' anysign_p_id = "+i+" >"+inner_string.substring(i,i+1)+"</font>"}else{inner_text+="<span class='mass_anysign_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</span>"}}tmp_title.innerHTML=inner_text;var scaleFactor=window.devicePixelRatio?window.devicePixelRatio:1;tmp_ctx.strokeStyle=commentObjTmp.penColor;tmp_ctx.lineWidth=base_stroke_width;tmp_ctx.lineCap="round";tmp_ctx.lineJoin="round";tmp_ctx.shadowBlur=5;comment_ok.onclick=function(){comment_signConfirm()
};comment_back.onclick=function(){comment_backCanvas()};comment_cancel.onclick=function(){comment_cancelSign()};document.body.onselectstart=document.body.oncontextmenu=function(){return false};if("ontouchstart" in document.documentElement){comment_canvas.ontouchstart=function(e){if(timer!=null){clearInterval(timer)}isDown=true;isWriting=true};comment_canvas.ontouchmove=function(e){if(isDown){var offset=JQuery_Capable.offset(e.target);if(typeof e.targetTouches!=="undefined"){curX=Math.floor(e.targetTouches[0].pageX-offset.left);curY=Math.floor(e.targetTouches[0].pageY-offset.top)}else{curX=Math.floor(e.pageX-offset.left);curY=Math.floor(e.pageY-offset.top)}var mill=e.timeStamp;if(signTrachPointCount===0&&!isNaN(mill)){firstPointTime=mill}if(curX>0&&curY<=comment_canvas.height){if(!isNaN(mill)){signTrack+=(curX+","+curY+","+base_stroke_width+","+(mill-firstPointTime)+"\n")}else{signTrack+=(curX+","+curY+","+base_stroke_width+","+0+"\n")}signTrachPointCount+=1;if(curX>maxX){maxX=curX}if(curX<minX){minX=curX}if(curY>maxY){maxY=curY}if(curY<minY){minY=curY}points.push({x:curX,y:curY});onCommentPaint();points_all.push({x:curX,y:curY});if(curX>0&&curY>0){sbuilder.push(curX,curY)}lastX=curX;lastY=curY}preventDefault(e)}};comment_canvas.ontouchend=function(e){if(isDown){var mill=e.timeStamp;if(!isNaN(mill)){signTrack+=("0,0,"+-1+","+(mill-firstPointTime)+"\n")}else{signTrack+=("0,0,"+-1+","+0+"\n")}signTrachPointCount+=1;sbuilder.push("-1","0");var canvas=document.getElementById("comment_canvas");var ctx=canvas.getContext("2d");ctx.drawImage(comment_canvas,0,0);var text=document.getElementById("signTitle");if(CurrentNum>=commentInner.length){alert("抄录已完成！");text.innerHTML="";isWriting=false;tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height)}else{if(isPoint){isPoint=false;timer=setInterval(function(){sbuilder.push("-1","-1");if(change_img_x){if(sign_last_text<=CurrentNum){sign_last_text=CurrentNum}if(anysign_p_id==CurrentNum){sign_last_text=sign_last_text+1}CurrentNum=anysign_p_id
}else{if(sign_last_text>CurrentNum){CurrentNum=sign_last_text}}if(commentObjTmp.isdistinguish&&!checkText(commentInner[CurrentNum])){var callback_dis=function(errCode,isEquals){closeWindow();if(errCode==0){if(isEquals){if(change_img_x){CurrentNum=sign_last_text-1}CurrentNum++;if(CurrentNum==commentInner.length){text.innerHTML="";tmp_title.innerHTML="抄录已完成！";tmp_title.style.color="Red";clearInterval(timer)}else{if(commentObjTmp.isShowBgText){text.innerHTML=commentInner[CurrentNum]}tmp_title.innerHTML=inner_string.substring(0,CurrentNum)+commentInner[CurrentNum].replace(commentInner[CurrentNum],'<font color="'+commentObjTmp.currentEditBarTextColor+'">$&</font>')+inner_string.substring(CurrentNum+1,commentInner.length);inner_text="";for(var i=0;i<inner_string.length;i++){if(i==CurrentNum){inner_text+="<font class='mass_anysign_p select_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</font>"}else{inner_text+="<span class='mass_anysign_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</span>"}}tmp_title.innerHTML=inner_text}var image=document.createElement("img");if(change_img_x){image.id="img"+(parseInt(anysign_p_id)+1)}else{image.id="img"+CurrentNum}image.width=commentObjTmp.mass_word_width;image.height=commentObjTmp.mass_word_height;if(checkText(commentInner[CurrentNum-1])){image.src=canvas.toDataURL("image/png")}else{var width=maxX-minX;var height=maxY-minY;var cx=(maxX+minX)/2;var cy=(maxY+minY)/2;var radius;if(width<20&&height<20){radius=commentObjTmp.mass_word_width}else{if(width>height){radius=width/2}else{radius=height/2}}C_imageDataTmp=comment_canvas.getContext("2d").getImageData(cx-radius-paste_padding,cy-radius-paste_padding,(radius+paste_padding)*2,(radius+paste_padding)*2);var signData=getCommentSigData();image.src=signData}if(change_img_x){myImage[anysign_p_id]=image}else{myImage[CurrentNum-1]=image}tmp_signImage.innerHTML="";var sign_img="";for(var i=0;i<myImage.length;i++){tmp_signImage.appendChild(myImage[i])}tmp_signImage.scrollTop=tmp_signImage.scrollHeight;
tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);minX=9999,minY=9999,maxX=0,maxY=0;sbuilder=[];if(timer!=null){clearInterval(timer)}change_img_x=0}}else{tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);minX=9999,minY=9999,maxX=0,maxY=0;sbuilder=[];clearInterval(timer)}if(identify_callback==null){console.log("the identify callback is not definition")}else{if(errCode!="请求超时"){identify_callback(errCode)}}};showProgress("正在识别，请稍候。。。");var ocrObj=new OCRObj(commentObjTmp.ocrCapture);ocrObj.recognition(sbuilder,commentInner[CurrentNum],callback_dis);isWriting=false;clearInterval(timer)}else{if(change_img_x){CurrentNum=sign_last_text-1}CurrentNum++;sbuilder=[];if(CurrentNum==commentInner.length){text.innerHTML="";tmp_title.innerHTML="抄录已完成！";tmp_title.style.color="Red";clearInterval(timer)}else{if(commentObjTmp.isShowBgText){text.innerHTML=commentInner[CurrentNum]}tmp_title.innerHTML=inner_string.substring(0,CurrentNum)+commentInner[CurrentNum].replace(commentInner[CurrentNum],'<font color="'+commentObjTmp.currentEditBarTextColor+'">$&</font>')+inner_string.substring(CurrentNum+1,commentInner.length);inner_text="";for(var i=0;i<inner_string.length;i++){if(i==CurrentNum){inner_text+="<font class='mass_anysign_p select_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</font>"}else{inner_text+="<span class='mass_anysign_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</span>"}}tmp_title.innerHTML=inner_text}var image=document.createElement("img");if(change_img_x){image.id="img"+(parseInt(anysign_p_id)+1)}else{image.id="img"+CurrentNum}image.width=commentObjTmp.mass_word_width;image.height=commentObjTmp.mass_word_height;if(checkText(commentInner[CurrentNum-1])){image.src=canvas.toDataURL("image/png")}else{var width=maxX-minX;var height=maxY-minY;var cx=(maxX+minX)/2;var cy=(maxY+minY)/2;var radius;if(width<20&&height<20){radius=commentObjTmp.mass_word_width}else{if(width>height){radius=width/2}else{radius=height/2}}C_imageDataTmp=comment_canvas.getContext("2d").getImageData(cx-radius-paste_padding,cy-radius-paste_padding,(radius+paste_padding)*2,(radius+paste_padding)*2);
var signData=getCommentSigData();image.src=signData}if(change_img_x){myImage[anysign_p_id]=image}else{myImage[CurrentNum-1]=image}tmp_signImage.innerHTML="";var sign_img="";for(var i=0;i<myImage.length;i++){tmp_signImage.appendChild(myImage[i])}tmp_signImage.scrollTop=tmp_signImage.scrollHeight;tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);minX=9999,minY=9999,maxX=0,maxY=0;signData=null;isWriting=false;clearInterval(timer);change_img_x=0}},1000)}}}isDown=false;points=[];points_all=[]};comment_canvas.ontouchcancel=comment_canvas.ontouchend}else{comment_canvas.onmousedown=function(e){if(timer!=null){clearInterval(timer)}isDown=true;isWriting=true};comment_canvas.onmousemove=function(e){if(isDown){var offset=JQuery_Capable.offset(e.target);var windowScrollOffsetTop=document.body.scrollTop|document.documentElement.scrollTop;var windowScrollOffsetLeft=document.body.scrollLeft|document.documentElement.scrollLeft;if(typeof e.targetTouches!=="undefined"){curX=Math.floor(e.targetTouches[0].clientX-offset.left);curY=Math.floor(e.targetTouches[0].clientY-offset.top)}else{curX=Math.floor(e.clientX-offset.left);curY=Math.floor(e.clientY-offset.top)}var mill=e.timeStamp;if(signTrachPointCount===0&&!isNaN(mill)){firstPointTime=mill}if(curX>0){if(!isNaN(mill)){signTrack+=(curX+","+curY+","+base_stroke_width+","+(mill-firstPointTime)+"\n")}else{signTrack+=(curX+","+curY+","+base_stroke_width+","+0+"\n")}signTrachPointCount+=1;curY+=windowScrollOffsetTop;curX+=windowScrollOffsetLeft;if(curX>maxX){maxX=curX}if(curX<minX){minX=curX}if(curY>maxY){maxY=curY}if(curY<minY){minY=curY}points.push({x:curX,y:curY});onCommentPaint();points_all.push({x:curX,y:curY});if(curX>0&&curY>0){sbuilder.push(curX,curY)}lastX=curX;lastY=curY}preventDefault(e)}};comment_canvas.onmouseup=function(e){if(isDown){isDown=false;var offset=JQuery_Capable.offset(e.target);if(typeof e.targetTouches!=="undefined"){curX=Math.floor(e.targetTouches[0].clientX-offset.left);curY=Math.floor(e.targetTouches[0].clientY-offset.top)
}else{curX=Math.floor(e.clientX-offset.left);curY=Math.floor(e.clientY-offset.top)}var mill=e.timeStamp;if(!isNaN(mill)){signTrack+=("0,0,"+-1+","+(mill-firstPointTime)+"\n")}else{signTrack+=("0,0,"+-1+","+0+"\n")}signTrachPointCount+=1;sbuilder.push("-1","0");var canvas=document.getElementById("comment_canvas");var ctx=canvas.getContext("2d");ctx.drawImage(comment_canvas,0,0);var text=document.getElementById("signTitle");if(CurrentNum>=commentInner.length){alert("抄录已完成！");text.innerHTML="";tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);isWriting=false}else{if(points_all.length>10){timer=setInterval(function(){sbuilder.push("-1","-1");if(change_img_x){if(sign_last_text<=CurrentNum){sign_last_text=CurrentNum}if(anysign_p_id==CurrentNum){sign_last_text=sign_last_text+1}CurrentNum=anysign_p_id}else{if(sign_last_text>CurrentNum){CurrentNum=sign_last_text}}if(commentObjTmp.isdistinguish&&!checkText(commentInner[CurrentNum])){var callback_dis=function(errCode,isEquals){closeWindow();if(errCode==0){if(isEquals){if(change_img_x){CurrentNum=sign_last_text-1}CurrentNum++;if(CurrentNum==commentInner.length){text.innerHTML="";tmp_title.innerHTML="抄录已完成！";tmp_title.style.color="Red";clearInterval(timer)}else{if(commentObjTmp.isShowBgText){text.innerHTML=commentInner[CurrentNum]}tmp_title.innerHTML=inner_string;tmp_title.innerHTML=inner_string.substring(0,CurrentNum)+commentInner[CurrentNum].replace(commentInner[CurrentNum],'<font color="'+commentObjTmp.currentEditBarTextColor+'">$&</font>')+inner_string.substring(CurrentNum+1,commentInner.length);inner_text="";for(var i=0;i<inner_string.length;i++){if(i==CurrentNum){inner_text+="<font class='mass_anysign_p select_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</font>"}else{inner_text+="<span class='mass_anysign_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</span>"}}tmp_title.innerHTML=inner_text}var image=document.createElement("img");if(change_img_x){image.id="img"+(parseInt(anysign_p_id)+1)
}else{image.id="img"+CurrentNum}image.width=commentObjTmp.mass_word_width;image.height=commentObjTmp.mass_word_height;if(checkText(commentInner[CurrentNum-1])){image.src=canvas.toDataURL("image/png")}else{var width=maxX-minX;var height=maxY-minY;var cx=(maxX+minX)/2;var cy=(maxY+minY)/2;var radius;if(width<20&&height<20){radius=commentObjTmp.mass_word_width}else{if(width>height){radius=width/2}else{radius=height/2}}C_imageDataTmp=comment_canvas.getContext("2d").getImageData(cx-radius-paste_padding,cy-radius-paste_padding,(radius+paste_padding)*2,(radius+paste_padding)*2);var signData=getCommentSigData();image.src=signData}if(change_img_x){myImage[anysign_p_id]=image}else{myImage[CurrentNum-1]=image}tmp_signImage.innerHTML="";var sign_img="";for(var i=0;i<myImage.length;i++){tmp_signImage.appendChild(myImage[i])}tmp_signImage.scrollTop=tmp_signImage.scrollHeight;tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);minX=9999,minY=9999,maxX=0,maxY=0;sbuilder=[];if(timer!=null){clearInterval(timer)}change_img_x=0}}else{tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);minX=9999,minY=9999,maxX=0,maxY=0;sbuilder=[];clearInterval(timer)}if(identify_callback==null){console.log("the identify callback is not definition")}else{if(errCode!="请求超时"){identify_callback(errCode)}}};showProgress("正在识别，请稍候。。。");var ocrObj=new OCRObj(commentObjTmp.ocrCapture);ocrObj.recognition(sbuilder,commentInner[CurrentNum],callback_dis);isWriting=false;clearInterval(timer)}else{if(change_img_x){CurrentNum=sign_last_text-1}CurrentNum++;sbuilder=[];if(CurrentNum==commentInner.length){text.innerHTML="";tmp_title.innerHTML="抄录已完成！";tmp_title.style.color="Red";clearInterval(timer)}else{if(commentObjTmp.isShowBgText){text.innerHTML=commentInner[CurrentNum]}tmp_title.innerHTML=inner_string.substring(0,CurrentNum)+commentInner[CurrentNum].replace(commentInner[CurrentNum],'<font color="'+commentObjTmp.currentEditBarTextColor+'">$&</font>')+inner_string.substring(CurrentNum+1,commentInner.length);
inner_text="";for(var i=0;i<inner_string.length;i++){if(i==CurrentNum){inner_text+="<font class='mass_anysign_p select_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</font>"}else{inner_text+="<span class='mass_anysign_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</span>"}}tmp_title.innerHTML=inner_text}var image=document.createElement("img");if(change_img_x){image.id="img"+(parseInt(anysign_p_id)+1)}else{image.id="img"+CurrentNum}image.width=commentObjTmp.mass_word_width;image.height=commentObjTmp.mass_word_height;if(checkText(commentInner[CurrentNum-1])){image.src=canvas.toDataURL("image/png")}else{var width=maxX-minX;var height=maxY-minY;var cx=(maxX+minX)/2;var cy=(maxY+minY)/2;var radius;if(width<20&&height<20){radius=commentObjTmp.mass_word_width}else{if(width>height){radius=width/2}else{radius=height/2}}C_imageDataTmp=comment_canvas.getContext("2d").getImageData(cx-radius-paste_padding,cy-radius-paste_padding,(radius+paste_padding)*2,(radius+paste_padding)*2);var signData=getCommentSigData();image.src=signData}if(change_img_x){myImage[anysign_p_id]=image}else{myImage[CurrentNum-1]=image}tmp_signImage.innerHTML="";var sign_img="";for(var i=0;i<myImage.length;i++){tmp_signImage.appendChild(myImage[i])}tmp_signImage.scrollTop=tmp_signImage.scrollHeight;tmp_ctx.clearRect(0,0,comment_canvas.width,comment_canvas.height);minX=9999,minY=9999,maxX=0,maxY=0;signData=null;isWriting=false;clearInterval(timer);change_img_x=0}},1000)}}isDown=false;points=[];points_all=[]}};comment_canvas.onmouseout=comment_canvas.onmouseup}function getCommentSigData(){if(C_imageDataTmp){var tmp_canvas=document.createElement("canvas");var ctx=tmp_canvas.getContext("2d");var scaleFactor=window.devicePixelRatio?window.devicePixelRatio:1;tmp_canvas.width=C_imageDataTmp.width/scaleFactor;tmp_canvas.height=C_imageDataTmp.height/scaleFactor;var scaleFactor2=1;if(commentObjTmp.mass_word_width/commentObjTmp.mass_word_height<=tmp_canvas.width/tmp_canvas.height){if(commentObjTmp.mass_word_width<=tmp_canvas.width){scaleFactor2=commentObjTmp.mass_word_width/tmp_canvas.width
}}else{if(commentObjTmp.singleHeight<=tmp_canvas.height){scaleFactor2=commentObjTmp.mass_word_height/tmp_canvas.height}}tmp_canvas.width*=scaleFactor2;tmp_canvas.height*=scaleFactor2;calculatedSigWidth=tmp_canvas.width;calculatedSigHeight=tmp_canvas.height;ctx.scale(1/scaleFactor*scaleFactor2,1/scaleFactor*scaleFactor2);var data_canvas=document.createElement("canvas");data_canvas.width=C_imageDataTmp.width;data_canvas.height=C_imageDataTmp.height;data_canvas.getContext("2d").putImageData(C_imageDataTmp,0,0);ctx.drawImage(data_canvas,0,0);var compressSignData=tmp_canvas.toDataURL();return compressSignData}return null}var onCommentPaint=function(){if(points.length<3){var b=points[0];tmp_ctx.beginPath();tmp_ctx.strokeStyle=commentObjTmp.penColor;tmp_ctx.fillStyle=commentObjTmp.penColor;tmp_ctx.arc(b.x,b.y,tmp_ctx.lineWidth/2,0,Math.PI*2,!0);tmp_ctx.fill();tmp_ctx.closePath();isPoint=true;return}tmp_ctx.clearRect(0,0,tmp_ctx.width,tmp_ctx.height);tmp_ctx.beginPath();tmp_ctx.strokeStyle=commentObjTmp.penColor;tmp_ctx.fillStyle=commentObjTmp.penColor;tmp_ctx.moveTo(points[0].x,points[0].y);for(var i=1;i<points.length-2;i++){var c=(points[i].x+points[i+1].x)/2;var d=(points[i].y+points[i+1].y)/2;tmp_ctx.quadraticCurveTo(points[i].x,points[i].y,c,d)}tmp_ctx.stroke();isPoint=true};function comment_backCanvas(){if(change_img_x){alert("请继续签名");return}if(isWriting){return}var this_CurrentNum=myImage.length;if(this_CurrentNum<=0){alert("已移除完，请重新进行签名！");line_width=0}else{var image=document.getElementById("img"+this_CurrentNum);var tmp_signImage=document.getElementById("signImage");tmp_signImage.removeChild(image);myImage.splice(this_CurrentNum-1,this_CurrentNum-1);this_CurrentNum--;CurrentNum--;sign_last_text=CurrentNum;rowNum--;var text=document.getElementById("signTitle");if(commentObjTmp.isShowBgText){text.innerHTML=commentInner[this_CurrentNum]}if(this_CurrentNum==0){line_width=0;rowNum=0}else{if(rowNum-1<0){rowNum=line_count;if(row_height>0){row_height--}line_width=0}else{line_width=rowNum*commentObjTmp.mass_word_width
}}var tmp_title=document.getElementById("comment_title");tmp_title.innerHTML=inner_string;tmp_title.style.color="black";inner_string.substring(this_CurrentNum+1,commentInner.length);inner_text="";for(var i=0;i<inner_string.length;i++){if(i==this_CurrentNum){inner_text+="<font class='mass_anysign_p select_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</font>"}else{inner_text+="<span class='mass_anysign_p' anysign_p_id = "+i+">"+inner_string.substring(i,i+1)+"</span>"}}tmp_title.innerHTML=inner_text}}function comment_cancelSign(){document.documentElement.style.overflow="auto";if(signResCallback){signResCallback(commentObjTmp.cid,null,null,0)}CurrentNum=0;sign_last_text=0;clear_all()}function comment_signConfirm(){if(isWriting){return}if(CurrentNum!=commentInner.length){custom_alert("请完成抄录","确认");return}draw();if(signResCallback){signResCallback(commentObjTmp.cid,base64[0].substring(22,base64[0].length),base64[0].substring(22,base64[0].length),signTrack,signTrachPointCount,imgWidth,imgHeight)}CurrentNum=0;sign_last_text=0;clear_all()}function clear_all(){var dlg=document.getElementById("comment_dialog");dlg.style.display="none";minX=9999,minY=9999,maxX=0,maxY=0;document.body.parentNode.style.overflow="scroll";var commentSign=document.getElementById("comment_sign");var tmp_textView=document.getElementById("comment_title");tmp_textView.innerHTML="";tmp_textView.style.color="black";var tmp_text=document.getElementById("signTitle");tmp_text.innerHTML="";tmp_signImage.innerHTML="";commentObjTmp=null}var base64=[];function draw(){var c=document.createElement("canvas"),ctx=c.getContext("2d"),len=commentObjTmp.mass_words_in_single_line;imgWidth=commentObjTmp.mass_word_width*len;imgHeight=commentObjTmp.mass_word_height*(inner_string.length/commentObjTmp.mass_words_in_single_line+1);c.width=imgWidth;c.height=imgHeight;ctx.rect(0,0,c.width,c.height);ctx.fillStyle="#fff";ctx.fill();var w=0;var h=0;var allNum=commentInner.length;function drawing(n){if(n<allNum){if(w>=commentObjTmp.mass_words_in_single_line){h=h+commentObjTmp.mass_word_height;
w=0}ctx.drawImage(myImage[n],commentObjTmp.mass_word_width*w,h,commentObjTmp.mass_word_width,commentObjTmp.mass_word_height);w++;drawing(n+1)}else{base64.push(c.toDataURL("image/png",1))}}drawing(0)}function setSignResCallback(signObj,callback){if(isSignOrCom(signObj.cid)){signObjTmp=signObj;signResCallback=callback;var canvas=document.getElementById("anysignCanvas");var ctx=canvas.getContext("2d");ctx.strokeStyle=signObjTmp?signObjTmp.penColor:"black"}else{commentObjTmp=signObj;signResCallback=callback;var canvas=document.getElementById("comment_canvas");var ctx=canvas.getContext("2d");ctx.strokeStyle=commentObjTmp.penColor;comment_canvas.strokeStyle=commentObjTmp.penColor}}window.addEventListener("resize",function(){if(timer!=null){clearInterval(timer)}var text=document.getElementById("signTitle");tmp_title.innerHTML=inner_string.substring(0,CurrentNum)+commentInner[CurrentNum].replace(commentInner[CurrentNum],'<font color="'+commentObjTmp.currentEditBarTextColor+'">$&</font>')+inner_string.substring(CurrentNum+1,commentInner.length);if(commentObjTmp.isShowBgText){if(CurrentNum>=commentInner.length){text.innerHTML=""}else{text.innerHTML=commentInner[CurrentNum]}}tmp_ctx.strokeStyle=commentObjTmp.penColor;tmp_ctx.lineWidth=base_stroke_width;tmp_ctx.lineCap="round";tmp_ctx.lineJoin="round";tmp_ctx.shadowBlur=5});window.addEventListener("orientationchange",function(){if(timer!=null){clearInterval(timer)}var text=document.getElementById("signTitle");tmp_title.innerHTML=inner_string.substring(0,CurrentNum)+commentInner[CurrentNum].replace(commentInner[CurrentNum],'<font color="'+commentObjTmp.currentEditBarTextColor+'">$&</font>')+inner_string.substring(CurrentNum+1,commentInner.length);tmp_ctx.strokeStyle=commentObjTmp.penColor;tmp_ctx.lineWidth=base_stroke_width;tmp_ctx.lineCap="round";tmp_ctx.lineJoin="round";tmp_ctx.shadowBlur=5});var change_img_x=0;var anysign_p_id;$(document).on("click",".mass_anysign_p",function(){anysign_p_id=$(this).attr("anysign_p_id");if(anysign_p_id>CurrentNum){return
}$(".mass_text").text(commentInner[anysign_p_id]);change_img_x=1;$(".select_p").removeClass("select_p");$(".mass_anysign_p[anysign_p_id='"+anysign_p_id+"']").addClass("select_p")})};
var points=[];var firstPointTime=0;var signTrack="";var signTrachPointCount=0;var calculatedSigWidth=0;var calculatedSigHeight=0;var minX=9999,minY=9999,maxX=0,maxY=0;var curX=0,curY=0;var lastX=0,lastY=0;var paste_padding=10;var imageDataTmp;var isDown=false;var isDrawn=false;var isAnysignInputDlgShown=false;var isCopyingImg=false;var base_stroke_width=(window.innerWidth>=480?7.5:5);var canvas;var ctx;var signResCallback;var signObjTmp;var bh_temp=getWindowHeight();var bw_temp=getWindowWidth();var isSign;var sbuilder=[];var identify_callback;var fresh=function(){clear_canvas();if(isSign){var pla=ismobile(1);if(pla==1){var canvas=document.getElementById("anysignCanvas");var ctx=canvas.getContext("2d");var tmp_canvas_private;var tmp_ctx_private;var width;var height;var tmp;if(isDrawn){tmp_canvas_private=document.createElement("canvas");tmp_ctx_private=tmp_canvas_private.getContext("2d");var default_padding=paste_padding;var fixedPaddingL=default_padding,fixedPaddingT=default_padding,fixedPaddingR=default_padding,fixedPaddingB=default_padding,left,top,right,bottom;if((left=(minX-default_padding))<0){fixedPaddingL=minX;left=0}if((top=(minY-default_padding))<0){fixedPaddingT=minY;top=0}if((right=(maxX+default_padding))>canvas.width){fixedPaddingR=0;right=canvas.width}if((bottom=(maxY+default_padding))>canvas.height){fixedPaddingB=0;bottom=canvas.height}width=maxX-minX+fixedPaddingL+fixedPaddingR;height=maxY-minY+fixedPaddingT+fixedPaddingB;tmp=ctx.getImageData(left,top,right-left,bottom-top);tmp_canvas_private.width=width;tmp_canvas_private.height=height}var bh=getWindowHeight();var bw=getWindowWidth();var dlg=document.getElementById("dialog");dlg.style.height=bh+"px";dlg.style.width=bw+"px";if(canvas.width<10){canvas.width=bw*canvas.width}if(canvas.width<bw){canvas.width=bw}canvas.height=bh*0.65;var container_canvas=document.getElementById("container");container_canvas.style.overflowX="scroll";container_canvas.style.overflowY="hidden";container_canvas.style.height=bh*0.65+"px";
var title=document.getElementById("anysign_title");title.style.height=bh*0.1+"px";var single_scrollbar=document.getElementById("single_scrollbar");single_scrollbar.style.height=bh*0.1+"px";var container=document.getElementById("btnContainerOuter");container.style.height=bh*0.1+"px"}else{if(pla==0){var bh;var bw;if(window.orientation==0||window.orientation==180){bh=getWindowHeight()*0.9;bw=getWindowWidth()}else{if(getWindowWidth()<569){var bhw=getWindowHeight()*0.75}else{var bhw=getWindowHeight()}var bww=getWindowWidth();bh=bhw;bw=bww}var canvas=document.getElementById("anysignCanvas");var ctx=canvas.getContext("2d");var tmp_canvas_private;var tmp_ctx_private;var width;var height;var tmp;if(isDrawn){tmp_canvas_private=document.createElement("canvas");tmp_ctx_private=tmp_canvas_private.getContext("2d");var default_padding=paste_padding;var fixedPaddingL=default_padding,fixedPaddingT=default_padding,fixedPaddingR=default_padding,fixedPaddingB=default_padding,left,top,right,bottom;if((left=(minX-default_padding))<0){fixedPaddingL=minX;left=0}if((top=(minY-default_padding))<0){fixedPaddingT=minY;top=0}if((right=(maxX+default_padding))>canvas.width){fixedPaddingR=0;right=canvas.width}if((bottom=(maxY+default_padding))>canvas.height){fixedPaddingB=0;bottom=canvas.height}width=maxX-minX+fixedPaddingL+fixedPaddingR;height=maxY-minY+fixedPaddingT+fixedPaddingB;tmp=ctx.getImageData(left,top,right-left,bottom-top);tmp_canvas_private.width=width;tmp_canvas_private.height=height}var dlg=document.getElementById("dialog");dlg.style.height=bh+"px";dlg.style.width=bw+"px";canvas.height=bh;if(canvas.width<10){canvas.width=bw*canvas.width}if(canvas.width<bw){canvas.width=bw}if(window.orientation==0||window.orientation==180){canvas.height=canvas.height*0.7;var container_canvas=document.getElementById("container");container_canvas.style.overflowX="scroll";container_canvas.style.overflowY="hidden";container_canvas.style.height=bh*0.7+"px";var title=document.getElementById("anysign_title");
title.style.height=bh*0.1+"px";var container=document.getElementById("btnContainerOuter");container.style.height=bh*0.2+"px";var contianerInner=document.getElementById("btnContainerInner");contianerInner.style.marginBottom=0}else{canvas.height=canvas.height*0.6;var container_canvas=document.getElementById("container");container_canvas.style.overflowX="scroll";container_canvas.style.overflowY="hidden";container_canvas.style.height=bh*0.6+"px";var title=document.getElementById("anysign_title");title.style.height=bh*0.1+"px";var container=document.getElementById("btnContainerOuter");container.style.height=bh*0.3+"px";var contianerInner=document.getElementById("btnContainerInner");contianerInner.style.marginBottom=container.style.height}}}if(tmp_canvas!=null){tmp_canvas.width=canvas.width;tmp_canvas.height=canvas.height}var pixalRatio=window.devicePixelRatio?window.devicePixelRatio:1;var screenSizeRatio=bww*canvas.height/142560;ctx.strokeStyle=signObjTmp?signObjTmp.penColor:"black";ctx.lineWidth=base_stroke_width;ctx.lineCap="round";ctx.lineJoin="round";ctx.shadowBlur=5;tmp_ctx.strokeStyle=signObjTmp?signObjTmp.penColor:"black";tmp_ctx.lineWidth=base_stroke_width;tmp_ctx.lineCap="round";tmp_ctx.lineJoin="round";tmp_ctx.shadowBlur=5;if(!isDrawn){tmp_canvas.getContext("2d").clearRect(0,0,canvas.width,canvas.height);return}var scaleFactor;if(canvas.width>width){if(canvas.height>=height){scaleFactor=1}else{scaleFactor=canvas.height/height}}else{if(canvas.width/canvas.height>width/height){scaleFactor=canvas.height/height}else{scaleFactor=canvas.width/width}}tmp_ctx_private.putImageData(tmp,0,0);var tmp_canvas_private_2=document.createElement("canvas");var tmp_ctx_private_2=tmp_canvas_private_2.getContext("2d");tmp_canvas_private_2.width=width*scaleFactor;tmp_canvas_private_2.height=height*scaleFactor;tmp_ctx_private_2.scale(scaleFactor,scaleFactor);tmp_ctx_private_2.drawImage(tmp_canvas_private,0,0);ctx.clearRect(0,0,canvas.width,canvas.height);ctx.drawImage(tmp_canvas_private_2,0,0);
minX=0;minY=0;maxX*=scaleFactor;maxY*=scaleFactor;tmp_canvas.getContext("2d").clearRect(0,0,canvas.width,canvas.height)}};window.addEventListener("orientationchange",fresh);window.addEventListener("resize",fresh);function onloadAnysignView(sign,identify_callback){this.isSign=sign;this.identify_callback=identify_callback;onload_singleSignCanvas();onload_singleSingScrollAction()}function onload_singleSignCanvas(){if(document.getElementById("anysignCanvas")){canvas=document.getElementById("anysignCanvas");ctx=canvas.getContext("2d");var windowHeight=getWindowHeight();var windowWidth=getWindowWidth();if(canvas.width<10){canvas.width=windowWidth*canvas.width*1.99}if(canvas.width<windowWidth){canvas.width=windowWidth*0.99}var container=document.getElementById("container");container.style.overflowX="scroll";container.style.overflowY="hidden";canvas.height=windowHeight*0.7;var title=document.getElementById("anysign_title");title.style.height=windowHeight*0.1+"px";var single_scrollbar=document.getElementById("single_scrollbar");single_scrollbar.style.height=windowHeight*0.1+"px";var btnContainerOuter=document.getElementById("btnContainerOuter");btnContainerOuter.style.height=windowHeight*0.1+"px";if("ontouchstart" in document.documentElement){canvas.ontouchstart=function(e){if(isCopyingImg){return false}isDown=true;ctx.strokeStyle=signObjTmp?signObjTmp.penColor:"black";ctx.lineWidth=base_stroke_width;ctx.lineCap="round";ctx.lineJoin="round";ctx.shadowBlur=5};canvas.ontouchmove=function(e){if(isDown&&!isCopyingImg){var offset=JQuery_Capable.offset(e.target);if(typeof e.targetTouches!=="undefined"){curX=Math.floor(e.targetTouches[0].pageX-offset.left);curY=Math.floor(e.targetTouches[0].pageY-offset.top)}else{curX=Math.floor(e.pageX-offset.left);curY=Math.floor(e.pageY-offset.top)}var mill=e.timeStamp;if(signTrachPointCount===0&&!isNaN(mill)){firstPointTime=mill}if(curX>0&&curY<=canvas.height){if(!isNaN(mill)){signTrack+=(curX+","+curY+","+base_stroke_width+","+(mill-firstPointTime)+"\n")
}else{signTrack+=(curX+","+curY+","+base_stroke_width+","+0+"\n")}signTrachPointCount+=1;if(curX>maxX){maxX=curX}if(curX<minX){minX=curX}if(curY>maxY){maxY=curY}if(curY<minY){minY=curY}points.push({x:curX,y:curY});onPaint();if(curX>0&&curY>0){sbuilder.push(curX,curY)}lastX=curX;lastY=curY}preventDefault(e)}};canvas.ontouchend=function(e){var mill=e.timeStamp;if(!isNaN(mill)){signTrack+=("0,0,"+-1+","+(mill-firstPointTime)+"\n")}else{signTrack+=("0,0,"+-1+","+0+"\n")}signTrachPointCount+=1;sbuilder.push("-1","0");isCopyingImg=true;isDown=false;canvas=document.getElementById("anysignCanvas");ctx=canvas.getContext("2d");ctx.drawImage(canvas,0,0);points=[];isCopyingImg=false};canvas.ontouchcancel=canvas.ontouchend}else{canvas.onmousedown=function(e){isDown=true;ctx.strokeStyle=signObjTmp?signObjTmp.penColor:"black";ctx.lineWidth=base_stroke_width;ctx.lineCap="round";ctx.lineJoin="round";ctx.shadowBlur=5};canvas.onmousemove=function(e){if(isDown){var offset=JQuery_Capable.offset(e.target);var windowScrollOffsetTop=document.body.scrollTop|document.documentElement.scrollTop;var windowScrollOffsetLeft=document.body.scrollLeft|document.documentElement.scrollLeft;if(typeof e.targetTouches!=="undefined"){curX=Math.floor(e.targetTouches[0].clientX-offset.left);curY=Math.floor(e.targetTouches[0].clientY-offset.top)}else{curX=Math.floor(e.clientX-offset.left);curY=Math.floor(e.clientY-offset.top)}var mill=e.timeStamp;if(signTrachPointCount===0&&!isNaN(mill)){firstPointTime=mill}if(curX>0){if(!isNaN(mill)){signTrack+=(curX+","+curY+","+base_stroke_width+","+(mill-firstPointTime)+"\n")}else{signTrack+=(curX+","+curY+","+base_stroke_width+","+0+"\n")}signTrachPointCount+=1;curY+=windowScrollOffsetTop;curX+=windowScrollOffsetLeft;if(curX>maxX){maxX=curX}if(curX<minX){minX=curX}if(curY>maxY){maxY=curY}if(curY<minY){minY=curY}points.push({x:curX,y:curY});onPaint();if(curX>0&&curY>0){sbuilder.push(curX,curY)}lastX=curX;lastY=curY}preventDefault(e)}};canvas.onmouseup=function(e){var offset=JQuery_Capable.offset(e.target);
if(typeof e.targetTouches!=="undefined"){curX=Math.floor(e.targetTouches[0].clientX-offset.left);curY=Math.floor(e.targetTouches[0].clientY-offset.top)}else{curX=Math.floor(e.clientX-offset.left);curY=Math.floor(e.clientY-offset.top)}var mill=e.timeStamp;if(!isNaN(mill)){signTrack+=("0,0,"+-1+","+(mill-firstPointTime)+"\n")}else{signTrack+=("0,0,"+-1+","+0+"\n")}signTrachPointCount+=1;if(isDown){sbuilder.push("-1","0")}isDown=false;var canvas=document.getElementById("anysignCanvas");var ctx=canvas.getContext("2d");ctx.drawImage(canvas,0,0);points=[]};canvas.onmouseout=canvas.onmouseup}var scaleFactor=window.devicePixelRatio?window.devicePixelRatio:1;ctx.strokeStyle=signObjTmp?signObjTmp.penColor:"black";ctx.lineWidth=base_stroke_width;ctx.lineCap="round";ctx.lineJoin="round";ctx.shadowBlur=5}else{alert("获取签名控件失败,请使用safari和chrome浏览器进行签名。\n\n当前浏览器详情如下："+navigator.userAgent)}}function onload_singleSingScrollAction(){var scroll_width=0;var current_scroll_pos=0;var should_scroll_pos=0;var single_container=document.getElementById("container");single_container.addEventListener("scroll",function(){current_scroll_pos=single_container.scrollLeft});var single_scrollbar_up=document.getElementById("single_scrollbar_up");single_scrollbar_up.addEventListener("click",function(){var single_container_width=single_container.clientWidth;var single_scroll_width=single_container.scrollWidth;scroll_width=Math.ceil(single_container_width*1/3);should_scroll_pos=current_scroll_pos-scroll_width>=0?current_scroll_pos-scroll_width:0;move_ScrollBarLeft()});var single_scrollbar_down=document.getElementById("single_scrollbar_down");single_scrollbar_down.addEventListener("click",function(){var single_container_width=single_container.clientWidth;var single_scroll_width=single_container.scrollWidth;scroll_width=Math.ceil(single_container_width*1/3);should_scroll_pos=current_scroll_pos+scroll_width>=single_scroll_width-single_container_width?single_scroll_width-single_container_width:current_scroll_pos+scroll_width;
move_ScrollBarRight()});var moveTime=50;var movePos=20;function move_ScrollBarLeft(){current_scroll_pos-=movePos;if(current_scroll_pos>should_scroll_pos){setTimeout(move_ScrollBarLeft,moveTime);single_container.scrollLeft=current_scroll_pos}else{current_scroll_pos=should_scroll_pos;single_container.scrollLeft=current_scroll_pos}if(current_scroll_pos<=0){single_container.style.borderColor="#FF0000";setTimeout(function(){single_container.style.borderColor="gray"},1000)}}function move_ScrollBarRight(){current_scroll_pos+=movePos;if(current_scroll_pos<should_scroll_pos){single_container.scrollLeft=current_scroll_pos;setTimeout(move_ScrollBarRight,moveTime)}else{current_scroll_pos=should_scroll_pos;single_container.scrollLeft=current_scroll_pos}if(current_scroll_pos>=single_container.scrollWidth-single_container.clientWidth){single_container.style.borderColor="#FF0000";setTimeout(function(){single_container.style.borderColor="gray"},1000)}}}var onPaint=function(){if(points.length<3){var b=points[0];ctx.beginPath();ctx.strokeStyle=signObjTmp.penColor;ctx.fillStyle=signObjTmp.penColor;ctx.arc(b.x,b.y,ctx.lineWidth/2,0,Math.PI*2,!0);ctx.fill();ctx.closePath();return}ctx.beginPath();ctx.strokeStyle=signObjTmp.penColor;ctx.fillStyle=signObjTmp.penColor;ctx.moveTo(points[0].x,points[0].y);for(var i=1;i<points.length-1;i++){var c=(points[i].x+points[i+1].x)/2;var d=(points[i].y+points[i+1].y)/2;ctx.quadraticCurveTo(points[i].x,points[i].y,c,d)}ctx.stroke();ctx.closePath();isDrawn=true};function clear_canvas(){var canvas=document.getElementById("anysignCanvas");var ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height);ctx.closePath();var w=canvas.width;var h=canvas.height;canvas.width=canvas.height=0;canvas.width=w;canvas.height=h;calculatedSigWidth=0;calculatedSigHeight=0;signTrack="";signTrachPointCount=0;firstPointTime=0;points=[];sbuilder=[];minX=9999,minY=9999,maxX=0,maxY=0;imageDataTmp=null;isDrawn=false}function sign_confirm(){if(!isDrawn){custom_alert("请确认签名是否已完成","确认");
return}if(signObjTmp.isdistinguish){sbuilder.push("-1","-1");var callback_dis=function(errCode,isEquals){closeWindow();if(errCode==0){var canvas=document.getElementById("anysignCanvas");var ctx=canvas.getContext("2d");var width=maxX-minX+paste_padding+paste_padding;var height=maxY-minY+paste_padding+paste_padding;imageDataTmp=ctx.getImageData(minX-paste_padding,minY-paste_padding,width+paste_padding,height+paste_padding);if(signResCallback){var sign_img=getSignData();check_img(sign_img);setTimeout(function(){if(this_img_isSign){var signData=sign_img.substr(22,getSignData().length);var canvas=document.getElementById("anysignCanvas");signResCallback(signObjTmp.cid,signData,signData,signTrack,signTrachPointCount,canvas.width,canvas.height)}else{custom_alert("请确认签名是否已完成","确认");return}},2)}document.body.parentNode.style.overflow="scroll";isSign=false}else{if(errCode=="请求超时"){closeWindow();clear_canvas()}else{if(identify_callback==null){console.log("the identify callback is not definition")}else{identify_callback(errCode)}clear_canvas()}}};showProgress("正在识别，请稍候。。。");var recoName="";var nameArray=(signObjTmp.signer.UName).replace(/(.)(?=[^$])/g,"$1,").split(",");for(var i=0;i<nameArray.length;i++){if(!checkText(nameArray[i])){recoName+=nameArray[i]}}var ocrObj=new OCRObj(signObjTmp.ocrCapture);ocrObj.recognition(sbuilder,recoName,callback_dis);sbuilder=[]}else{var canvas=document.getElementById("anysignCanvas");var ctx=canvas.getContext("2d");var width=maxX-minX+paste_padding+paste_padding;var height=maxY-minY+paste_padding+paste_padding;imageDataTmp=ctx.getImageData(minX-paste_padding,minY-paste_padding,width+paste_padding,height+paste_padding);if(signResCallback){var sign_img=getSignData();check_img(sign_img);setTimeout(function(){if(this_img_isSign){var signData=sign_img.substr(22,getSignData().length);var canvas=document.getElementById("anysignCanvas");signResCallback(signObjTmp.cid,signData,signData,signTrack,signTrachPointCount,canvas.width,canvas.height)}else{custom_alert("请确认签名是否已完成","确认");
return}},2)}document.body.parentNode.style.overflow="scroll";isSign=false}}function setSignResCallback(signObj,callback){if(isSignOrCom(signObj.cid)){signObjTmp=signObj;signResCallback=callback;var canvas=document.getElementById("anysignCanvas");var ctx=canvas.getContext("2d");ctx.strokeStyle=signObjTmp?signObjTmp.penColor:"black"}else{commentObjTmp=signObj;signResCallback=callback;var canvas=document.getElementById("comment_canvas");var ctx=canvas.getContext("2d");ctx.strokeStyle=commentObjTmp?commentObjTmp.penColor:"black";comment_canvas.strokeStyle=commentObjTmp?commentObjTmp.penColor:"black"}}function setCanvasHeight(height){var canvas=document.getElementById("anysignCanvas");if(height>0){canvas.height=height;if(canvas){canvas.height=height}}}function getSignData(){if(imageDataTmp){var tmp_canvas=document.createElement("canvas");var ctx=tmp_canvas.getContext("2d");var scaleFactor=window.devicePixelRatio?window.devicePixelRatio:1;tmp_canvas.width=imageDataTmp.width/scaleFactor;tmp_canvas.height=imageDataTmp.height/scaleFactor;var scaleFactor2=1;if(signObjTmp.singleWidth/signObjTmp.singleHeight<=tmp_canvas.width/tmp_canvas.height){if(signObjTmp.singleWidth<=tmp_canvas.width){scaleFactor2=signObjTmp.singleWidth/tmp_canvas.width}}else{if(signObjTmp.singleHeight<=tmp_canvas.height){scaleFactor2=signObjTmp.singleHeight/tmp_canvas.height}}tmp_canvas.width*=scaleFactor2;tmp_canvas.height*=scaleFactor2;calculatedSigWidth=tmp_canvas.width;calculatedSigHeight=tmp_canvas.height;var data_canvas=document.createElement("canvas");data_canvas.width=imageDataTmp.width;data_canvas.height=imageDataTmp.height;data_canvas.getContext("2d").putImageData(imageDataTmp,0,0);ctx.drawImage(data_canvas,0,0,calculatedSigWidth,calculatedSigHeight);var compressSignData=tmp_canvas.toDataURL();return compressSignData}return null}function getRawSigHeight(){if(imageDataTmp){if(window.devicePixelRatio!==undefined){return imageDataTmp.height/window.devicePixelRatio}return imageDataTmp.height}return 0}function getRawSigWidth(){if(imageDataTmp){if(window.devicePixelRatio!==undefined){return imageDataTmp.width/window.devicePixelRatio
}return imageDataTmp.width}return 0}function cancelSign(){clear_canvas();var dlg=document.getElementById("dialog");dlg.style.display="none";document.body.scroll="yes";isSign=false;if(signResCallback){signResCallback(signObjTmp.cid,null,null,0)}}function setIsAnysignInputDlgShown(isShown){isAnysignInputDlgShown=isShown}function testGetImageData(){}function testEnc(){var enc=tripleDesEncrypt("abcdefg","000102030405060708090a0b0c0d0e0f");var res=document.getElementById("result");res.value=enc}function testEncAndDec(){var encKey="133434";var message="abdfdsafdasfcdef132432432432g你好吗,,,fdafdas";var enc=tripleDesEncrypt(message,encKey)+"";var dec=tripleDesDecrypt(enc,encKey)+"";var soucre_str=anysign.hex.hexStrToUint8Str(dec);var result=message+"\n";result+=enc+"\n";result+=soucre_str+"\n";var jsonStr='{"Alg":"111","Value":"2222"}';var datagaga=anysign.json.stringToObj(jsonStr);var res=document.getElementById("result");res.value=result}function custom_alert(message,buttonText){showMsgDialog(message)}function preventDefault(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}e.returnValue=false}var JQuery_Capable={offset:function(obj){var core_strundefined=typeof undefined;var docElem,win,box={top:0,left:0},elem=obj,doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(typeof elem.getBoundingClientRect!==core_strundefined){box=elem.getBoundingClientRect()}win=JQuery_Capable.getWindow(doc);return{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}},getWindow:function(elem){return JQuery_Capable.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false},isWindow:function(obj){return obj!=null&&obj==obj.window}};var isIe=(document.all)?true:false;var messContent;function setSelectState(state){var objl=document.getElementsByTagName("select");for(var i=0;i<objl.length;i++){objl[i].style.visibility=state}}function showMessageBox2(wTitle,content,pos,wWidth){closeWindow();
var bHeight=getWindowHeight();var bWidth=getWindowWidth();if(isIe){setSelectState("hidden")}var back=document.createElement("div");back.id="back";var styleStr="font-size:15pt; text-align:center; z-index:7;top:0px;left:0px;position:fixed;background:#666;width:"+bWidth+"px;height:"+bHeight+"px;";styleStr+=(isIe)?"filter:alpha(opacity=0);":"opacity:0;";back.style.cssText=styleStr;var mesW=document.createElement("div");mesW.id="mesWindow";mesW.innerHTML="<div id='mesWindowContent'>"+content+"</div><div id='mesWindowBottom'><input id='mesWindowBtnOk' type='button' onclick='closeWindow();'value='确认' /></div>";back.appendChild(mesW);document.body.appendChild(back);showBackground(back,80);if("ontouchstart" in document.documentElement){back.ontouchstart=function(e){if(e.target.id!=="mesWindowBtnOk"){preventDefault(e);return false}return true};back.ontouchmove=function(e){preventDefault(e)}}else{back.onmousedown=function(e){if(e.target.id!=="mesWindowBtnOk"){preventDefault(e)}};back.onmousemove=function(e){preventDefault(e)}}}function showBackground(obj,endInt){if(isIe){obj.filters.alpha.opacity+=1;if(obj.filters.alpha.opacity<endInt){setTimeout(function(){showBackground(obj,endInt)},5)}}else{var al=parseFloat(obj.style.opacity);al+=0.01;obj.style.opacity=al;if(al<(endInt/100)){setTimeout(function(){showBackground(obj,endInt)},5)}}}function closeWindow(){if(document.getElementById("back")!=null){document.getElementById("back").parentNode.removeChild(document.getElementById("back"))}if(document.getElementById("mesWindow")!=null){document.getElementById("mesWindow").parentNode.removeChild(document.getElementById("mesWindow"))}if(isIe){setSelectState("")}}function showMsgDialog(msg){showMessageBox2("修改小结内容",msg,null,350)}function showProgress(msg){showMsgProgress("修改小结内容",msg,null,350)}function showMsgProgress(wTitle,content,pos,wWidth){closeWindow();var bHeight=getWindowHeight()/0.99;var bWidth=getWindowWidth()/0.99;if(isIe){setSelectState("hidden")}var back=document.createElement("div");
back.id="back";var styleStr="font-size:15pt; text-align:center; z-index:7;top:0px;left:0px;position:fixed;background:#666;width:"+bWidth+"px;height:"+bHeight+"px;";styleStr+=(isIe)?"filter:alpha(opacity=0);":"opacity:0;";back.style.cssText=styleStr;var mesW=document.createElement("div");mesW.id="mesWindow";mesW.innerHTML="<div id='mesWindowContent'>"+content+"</div>";back.appendChild(mesW);document.body.appendChild(back);showBackground(back,80)}function check_img(base64){var check_canvas=document.createElement("canvas");var check_context=check_canvas.getContext("2d");var img=new Image();img.src=base64;var img_width=50;var img_height=50;check_canvas.width=img_width;check_canvas.height=img_height;setTimeout(function(){check_context.drawImage(img,0,0,img_width,img_height);var imageData=check_context.getImageData(0,0,img_width,img_height);var arr=imageData.data;var brr=[];for(var a=0;a<arr.length;a++){var arrItem=arr[a];if(arrItem!==0){brr.push(arrItem)}}if(brr.length>0){this_img_isSign=true}else{this_img_isSign=false}},1)};
(function(){try{var a=new Uint8Array(1);return}catch(e){}function subarray(start,end){return this.slice(start,end)}function set_(array,offset){if(arguments.length<2){offset=0}for(var i=0,n=array.length;i<n;++i,++offset){this[offset]=array[i]&255}}function TypedArray(arg1){var result;if(typeof arg1==="number"){result=new Array(arg1);for(var i=0;i<arg1;++i){result[i]=0}}else{result=arg1.slice(0)}result.subarray=subarray;result.buffer=result;result.byteLength=result.length;result.set=set_;if(typeof arg1==="object"&&arg1.buffer){result.buffer=arg1.buffer}return result}window.Uint8Array=TypedArray;window.Uint32Array=TypedArray;window.Int32Array=TypedArray})();(function(){if("response" in XMLHttpRequest.prototype||"mozResponseArrayBuffer" in XMLHttpRequest.prototype||"mozResponse" in XMLHttpRequest.prototype||"responseArrayBuffer" in XMLHttpRequest.prototype){return}Object.defineProperty(XMLHttpRequest.prototype,"response",{get:function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}})})();(function(){if("btoa" in window){return}var digits="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";window.btoa=function(chars){var buffer="";var i,n;for(i=0,n=chars.length;i<n;i+=3){var b1=chars.charCodeAt(i)&255;var b2=chars.charCodeAt(i+1)&255;var b3=chars.charCodeAt(i+2)&255;var d1=b1>>2,d2=((b1&3)<<4)|(b2>>4);var d3=i+1<n?((b2&15)<<2)|(b3>>6):64;var d4=i+2<n?(b3&63):64;buffer+=digits.charAt(d1)+digits.charAt(d2)+digits.charAt(d3)+digits.charAt(d4)}return buffer}})();var capabal=capabal||{crypto:{getRandomValues:function(array){var tmp,current,top=array.length;if(top){while(--top){current=Math.floor(Math.random()*(top+1));tmp=array[current];array[current]=array[top];array[top]=tmp}}return array}}};function toUInt(number){return number<0?number+4294967296:number}function bytes32(number){return[(number>>>24)&255,(number>>>16)&255,(number>>>8)&255,number&255]}function bytes16sw(number){return[number&255,(number>>>8)&255]}function adler32(obj,start,len){switch(arguments.length){case 1:start=0;
case 2:len=obj.length-start}var a=1,b=0;for(var i=0;i<len;i++){a=(a+obj[start+i])%65521;b=(b+a)%65521}return toUInt(((b<<16)|a))}function crc32(obj,start,len){switch(arguments.length){case 1:start=0;case 2:len=obj.length-start}var table=arguments.callee.crctable;if(!table){table=[];var c;for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^(c>>>1):c>>>1}table[n]=toUInt(c)}arguments.callee.crctable=table}var c=4294967295;for(var i=0;i<len;i++){c=table[(c^obj[start+i])&255]^(c>>>8)}return toUInt((c^4294967295))}(function(){var toDataURL=function(){var imageData=Array.prototype.slice.call(this.getContext("2d").getImageData(0,0,this.width,this.height).data);var w=this.width;var h=this.height;var stream=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82];Array.prototype.push.apply(stream,bytes32(w));Array.prototype.push.apply(stream,bytes32(h));stream.push(8,6,0,0,0);Array.prototype.push.apply(stream,bytes32(crc32(stream,12,17)));var len=h*(w*4+1);for(var y=0;y<h;y++){imageData.splice(y*(w*4+1),0,0)}var blocks=Math.ceil(len/32768);Array.prototype.push.apply(stream,bytes32((len+5*blocks+6)));var crcStart=stream.length;var crcLen=(len+5*blocks+6+4);stream.push(73,68,65,84,120,1);for(var i=0;i<blocks;i++){var blockLen=Math.min(32768,len-(i*32768));stream.push(i==(blocks-1)?1:0);Array.prototype.push.apply(stream,bytes16sw(blockLen));Array.prototype.push.apply(stream,bytes16sw((~blockLen)));var id=imageData.slice(i*32768,i*32768+blockLen);Array.prototype.push.apply(stream,id)}Array.prototype.push.apply(stream,bytes32(adler32(imageData)));Array.prototype.push.apply(stream,bytes32(crc32(stream,crcStart,crcLen)));stream.push(0,0,0,0,73,69,78,68);Array.prototype.push.apply(stream,bytes32(crc32(stream,stream.length-4,4)));return"data:image/png;base64,"+btoa(stream.map(function(c){return String.fromCharCode(c)}).join(""))};var tdu=HTMLCanvasElement.prototype.toDataURL;HTMLCanvasElement.prototype.toDataURL=function(type){var res=tdu.apply(this,arguments);if(res=="data:,"){HTMLCanvasElement.prototype.toDataURL=toDataURL;
return this.toDataURL()}else{HTMLCanvasElement.prototype.toDataURL=tdu;return res}}})();
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeUint8Array:function(uint8Array){var CHUNK_SIZE=32768;var index=0;var length=uint8Array.length;var result="";var slice;var slice_tmp="";while(index<length){slice=uint8Array.subarray(index,Math.min(index+CHUNK_SIZE,length));for(var i=0,len=slice.length;i<len;i++){slice_tmp+=String.fromCharCode(slice[i])}result+=slice_tmp;index+=CHUNK_SIZE;slice_tmp=""}return btoa(result)},decode:function(base64){var bufferLength=base64.length*0.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]==="="){bufferLength--;if(base64[base64.length-2]==="="){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=lookup[base64.charCodeAt(i)];encoded2=lookup[base64.charCodeAt(i+1)];encoded3=lookup[base64.charCodeAt(i+2)];encoded4=lookup[base64.charCodeAt(i+3)];bytes[p++]=(encoded1<<2)|(encoded2>>4);bytes[p++]=((encoded2&15)<<4)|(encoded3>>2);bytes[p++]=((encoded3&3)<<6)|(encoded4&63)}return arraybuffer},encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else{if(isNaN(chr3)){enc4=64}}output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4)}return output},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else{if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128)}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128)
}}}return utftext},_utf8_decode:function(utftext){var string="";var i=0;var c=0,c1=0,c2=0,c3=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else{if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3}}}return string}};var anysign=anysign||{binary:{uint32ArrayToUint8Array:function(uint32Array){if(!uint32Array){return null}var uint8=new Uint8Array(uint32Array.length*4);var offset;for(var i=0,size=uint32Array.length;i<size;i++){offset=(i<<2);uint8[offset]=((uint32Array[i]>>24)&255);uint8[offset+1]=((uint32Array[i]>>16)&255);uint8[offset+2]=((uint32Array[i]>>8)&255);uint8[offset+3]=uint32Array[i]&255}return uint8}},hex:{hexEncodeArray:["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],uint8ArrayToHexStr:function(array){if(!array){return null}var res="";for(var i=0;i<array.length;i++){var code=array[i];res+=this.hexEncodeArray[code>>>4];res+=this.hexEncodeArray[code&15]}return res},hexStrToUint8Array:function(hexStr){if(!hexStr||hexStr.length%2!=0){return null}var a=[];for(var i=0;i<hexStr.length;i+=2){a.push(parseInt("0x"+hexStr.substr(i,2),16))}return new Uint8Array(a)},hexStrToUint8Str:function(hexStr){if(!hexStr||hexStr.length%2!=0){return null}var _utf8="";for(var i=0;i<hexStr.length;i+=2){_utf8+=String.fromCharCode(parseInt("0x"+hexStr.substr(i,2),16))}return decodeURIComponent(escape(_utf8))}},charset:{strToUtf8ArrayUint8:function(str){var utf8=unescape(encodeURIComponent(str));var arr=new Uint8Array(utf8.length);for(var i=0;i<utf8.length;i++){arr[i]=utf8.charCodeAt(i)}return arr},utf8ArrayUint8ToStr:function(bytes){var _utf8="";for(var j=0;j<bytes.length;j++){_utf8+=String.fromCharCode(bytes[j])}return decodeURIComponent(escape(_utf8))},toUtf8str:function(str){return unescape(encodeURIComponent(str))},uint8ArrayAscIIToStr:function(uint8Array){return String.fromCharCode.apply(null,uint8Array)
},strToUint8ArrayAscII:function(str){var res=new Uint8Array(str.length);for(var i=0,j=str.length;i<j;++i){res[i]=str.charCodeAt(i)}return res}},zip:{compressToB64:function(dataUint8){var deflate=new Zlib.Deflate(dataUint8);var compressed=deflate.compress();if(compressed instanceof Array){var u8Array=new Uint8Array(compressed.length);for(var i=0,j=u8Array.length;i<j;++i){u8Array[i]=compressed[i]}compressed=u8Array}return Base64.encodeUint8Array(compressed)}},json:{stringify:function(obj){return JSON.stringify(obj)},stringToObj:function(str){return JSON.parse(str)}},digest:{crc32:function(msgStr){var crcTable=[];if(!window.crcTable){var c;for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=((c&1)?(3988292384^(c>>>1)):(c>>>1))}crcTable[n]=c}window.crcTable=crcTable}else{crcTable=window.crcTable}var crc=0^(-1);for(var i=0;i<msgStr.length;i++){crc=(crc>>>8)^crcTable[(crc^msgStr.charCodeAt(i))&255]}return(crc^(-1))>>>0}}};(function(e){function k(){for(var b=!0,a,g=l,c=d.length;g<c&&b;){if(a=d[g],void 0!==a&&null!==a){if("string"===typeof a){var f=m.cloneNode(!1);f.text=a;h.parentNode.insertBefore(f,h)}else{a.apply(e)}a=g;d[a]=null;l=a+1;g+=1}else{b=!1}}}function f(){if(d.length){var b=d.pop(),a;"string"===typeof b?(a=m.cloneNode(!0),a.type="text/javascript",a.async=!0,a.src=b,a.onload=a.onreadystatechange=function(){if(!a.readyState||/loaded|complete/.test(a.readyState)){a.onload=a.onreadystatechange=null,a=void 0,f()}},h.parentNode.insertBefore(a,h)):(b.apply(e),f())}}function p(b,a){return function(){d[a]=b.responseText;k();b=void 0}}function q(){var b=arguments.length,a,c;for(a=0;a<b;a+=1){"string"===typeof arguments[a]?(c=i(arguments[a]),c.onload=p(c,d.length),d[d.length]=null,c.send()):(d[d.length]=arguments[a],k())}}function r(){d.push(Array.prototype.slice.call(arguments,0).reverse());f()}var n=e.document,m=n.createElement("script"),h=n.getElementsByTagName("script")[0],d=[],l=0,i,c,j;e.XMLHttpRequest&&(c=new e.XMLHttpRequest,"withCredentials" in c?j=function(b){c=new e.XMLHttpRequest;
c.open("get",b,!0);return c}:e.XDomainRequest&&(j=function(b){c=new e.XDomainRequest;c.open("get",b);return c}));i=j;e.JcorsLoader={load:i?q:r}})(window);
var dbits;var canary=244837814094590;var j_lm=((canary&16777215)==15715070);function BigInteger(a,b,c){if(a!=null){if("number"==typeof a){this.fromNumber(a,b,c)}else{if(b==null&&"string"!=typeof a){this.fromString(a,256)}else{this.fromString(a,b)}}}}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864);w[j++]=v&67108863}return c}function am2(i,x,w,j,c,n){var xl=x&32767,xh=x>>15;while(--n>=0){var l=this[i]&32767;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&32767)<<15)+w[j]+(c&1073741823);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&1073741823}return c}function am3(i,x,w,j,c,n){var xl=x&16383,xh=x>>14;while(--n>=0){var l=this[i]&16383;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&16383)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&268435455}return c}if(j_lm&&(navigator.appName=="Microsoft Internet Explorer")){BigInteger.prototype.am=am2;dbits=30}else{if(j_lm&&(navigator.appName!="Netscape")){BigInteger.prototype.am=am1;dbits=26}else{BigInteger.prototype.am=am3;dbits=28}}BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=((1<<dbits)-1);BigInteger.prototype.DV=(1<<dbits);var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array();var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv){BI_RC[rr++]=vv}rr="a".charCodeAt(0);for(vv=10;vv<36;++vv){BI_RC[rr++]=vv}rr="A".charCodeAt(0);for(vv=10;vv<36;++vv){BI_RC[rr++]=vv}function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return(c==null)?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i){r[i]=this[i]}r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=(x<0)?-1:0;if(x>0){this[0]=x}else{if(x<-1){this[0]=x+this.DV}else{this.t=0}}}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var k;if(b==16){k=4}else{if(b==8){k=3}else{if(b==256){k=8}else{if(b==2){k=1
}else{if(b==32){k=5}else{if(b==4){k=2}else{this.fromRadix(s,b);return}}}}}}this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=(k==8)?s[i]&255:intAt(s,i);if(x<0){if(s.charAt(i)=="-"){mi=true}continue}mi=false;if(sh==0){this[this.t++]=x}else{if(sh+k>this.DB){this[this.t-1]|=(x&((1<<(this.DB-sh))-1))<<sh;this[this.t++]=(x>>(this.DB-sh))}else{this[this.t-1]|=x<<sh}}sh+=k;if(sh>=this.DB){sh-=this.DB}}if(k==8&&(s[0]&128)!=0){this.s=-1;if(sh>0){this[this.t-1]|=((1<<(this.DB-sh))-1)<<sh}}this.clamp();if(mi){BigInteger.ZERO.subTo(this,this)}}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c){--this.t}}function bnToString(b){if(this.s<0){return"-"+this.negate().toString(b)}var k;if(b==16){k=4}else{if(b==8){k=3}else{if(b==2){k=1}else{if(b==32){k=5}else{if(b==4){k=2}else{return this.toRadix(b)}}}}}var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-(i*this.DB)%k;if(i-->0){if(p<this.DB&&(d=this[i]>>p)>0){m=true;r=int2char(d)}while(i>=0){if(p<k){d=(this[i]&((1<<p)-1))<<(k-p);d|=this[--i]>>(p+=this.DB-k)}else{d=(this[i]>>(p-=k))&km;if(p<=0){p+=this.DB;--i}}if(d>0){m=true}if(m){r+=int2char(d)}}}return m?r:"0"}function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return(this.s<0)?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0){return r}var i=this.t;r=i-a.t;if(r!=0){return(this.s<0)?-r:r}while(--i>=0){if((r=this[i]-a[i])!=0){return r}}return 0}function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16}if((t=x>>8)!=0){x=t;r+=8}if((t=x>>4)!=0){x=t;r+=4}if((t=x>>2)!=0){x=t;r+=2}if((t=x>>1)!=0){x=t;r+=1}return r}function bnBitLength(){if(this.t<=0){return 0}return this.DB*(this.t-1)+nbits(this[this.t-1]^(this.s&this.DM))}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i){r[i+n]=this[i]}for(i=n-1;i>=0;--i){r[i]=0}r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i){r[i-n]=this[i]}r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;
var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=(this.s<<bs)&this.DM,i;for(i=this.t-1;i>=0;--i){r[i+ds+1]=(this[i]>>cbs)|c;c=(this[i]&bm)<<bs}for(i=ds-1;i>=0;--i){r[i]=0}r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs}if(bs>0){r[this.t-ds-1]|=(this.s&bm)<<cbs}r.t=this.t-ds;r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB}c-=a.s}r.s=(c<0)?-1:0;if(c<-1){r[i++]=this.DV+c}else{if(c>0){r[i++]=c}}r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0){r[i]=0}for(i=0;i<y.t;++i){r[i+x.t]=x.am(0,y[i],r,i,0,x.t)}r.s=0;r.clamp();if(this.s!=a.s){BigInteger.ZERO.subTo(r,r)}}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0){r[i]=0}for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(r.t>0){r[r.t-1]+=x.am(i,x[i],r,2*i,0,1)}r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0){return}var pt=this.abs();if(pt.t<pm.t){if(q!=null){q.fromInt(0)}if(r!=null){this.copyTo(r)}return}if(r==null){r=nbi()}var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)}var ys=y.t;var y0=y[ys-1];if(y0==0){return}var yt=y0*(1<<this.F1)+((ys>1)?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=(q==null)?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r)}BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys){y[y.t++]=0}while(--j>=0){var qd=(r[--i]==y0)?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);
if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd){r.subTo(t,r)}}}if(q!=null){r.drShiftTo(ys,q);if(ts!=ms){BigInteger.ZERO.subTo(q,q)}}r.t=ys;r.clamp();if(nsh>0){r.rShiftTo(nsh,r)}if(ts<0){BigInteger.ZERO.subTo(r,r)}}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(BigInteger.ZERO)>0){a.subTo(r,r)}return r}function Classic(m){this.m=m}function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0){return x.mod(this.m)}else{return x}}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1){return 0}var x=this[0];if((x&1)==0){return 0}var y=x&3;y=(y*(2-(x&15)*y))&15;y=(y*(2-(x&255)*y))&255;y=(y*(2-(((x&65535)*y)&65535)))&65535;y=(y*(2-x*y%this.DV))%this.DV;return(y>0)?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<(m.DB-15))-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(BigInteger.ZERO)>0){this.m.subTo(r,r)}return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2){x[x.t++]=0}for(var i=0;i<this.m.t;++i){var j=x[i]&32767;var u0=(j*this.mpl+(((j*this.mph+(x[i]>>15)*this.mpl)&this.um)<<15))&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0){x.subTo(this.m,x)}}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;
Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return((this.t>0)?(this[0]&1):this.s)==0}function bnpExp(e,z){if(e>4294967295||e<1){return BigInteger.ONE}var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&(1<<i))>0){z.mulTo(r2,g,r)}else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(e<256||m.isEven()){z=new Classic(m)}else{z=new Montgomery(m)}return this.exp(e,z)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);function Arcfour(){this.i=0;this.j=0;this.S=new Array()}function ARC4init(key){var i,j,t;for(i=0;i<256;++i){this.S[i]=i}j=0;for(i=0;i<256;++i){j=(j+this.S[i]+key[i%key.length])&255;t=this.S[i];this.S[i]=this.S[j];this.S[j]=t}this.i=0;this.j=0}function ARC4next(){var t;this.i=(this.i+1)&255;this.j=(this.j+this.S[this.i])&255;t=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=t;return this.S[(t+this.S[this.i])&255]}Arcfour.prototype.init=ARC4init;Arcfour.prototype.next=ARC4next;function prng_newstate(){return new Arcfour()}var rng_psize=256;var rng_state;var rng_pool;var rng_pptr;
function rng_seed_int(x){rng_pool[rng_pptr++]^=x&255;rng_pool[rng_pptr++]^=(x>>8)&255;rng_pool[rng_pptr++]^=(x>>16)&255;rng_pool[rng_pptr++]^=(x>>24)&255;if(rng_pptr>=rng_psize){rng_pptr-=rng_psize}}function rng_seed_time(){rng_seed_int(new Date().getTime())}if(rng_pool==null){rng_pool=new Array();rng_pptr=0;var t;if(window.crypto&&window.crypto.getRandomValues){var ua=new Uint8Array(32);window.crypto.getRandomValues(ua);for(t=0;t<32;++t){rng_pool[rng_pptr++]=ua[t]}}if(navigator.appName=="Netscape"&&navigator.appVersion<"5"&&window.crypto){var z=window.crypto.random(32);for(t=0;t<z.length;++t){rng_pool[rng_pptr++]=z.charCodeAt(t)&255}}while(rng_pptr<rng_psize){t=Math.floor(65536*Math.random());rng_pool[rng_pptr++]=t>>>8;rng_pool[rng_pptr++]=t&255}rng_pptr=0;rng_seed_time()}function rng_get_byte(){if(rng_state==null){rng_seed_time();rng_state=prng_newstate();rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr){rng_pool[rng_pptr]=0}rng_pptr=0}return rng_state.next()}function rng_get_bytes(ba){var i;for(i=0;i<ba.length;++i){ba[i]=rng_get_byte()}}function SecureRandom(){}SecureRandom.prototype.nextBytes=rng_get_bytes;function parseBigInt(str,r){return new BigInteger(str,r)}function linebrk(s,n){var ret="";var i=0;while(i+n<s.length){ret+=s.substring(i,i+n)+"\n";i+=n}return ret+s.substring(i,s.length)}function byte2Hex(b){if(b<16){return"0"+b.toString(16)}else{return b.toString(16)}}function pkcs1pad2(s,n){if(n<s.length+11){alert("Message too long for RSA");return null}var ba=new Array();var i=s.length-1;while(i>=0&&n>0){var c=s.charCodeAt(i--);if(c<128){ba[--n]=c}else{if((c>127)&&(c<2048)){ba[--n]=(c&63)|128;ba[--n]=(c>>6)|192}else{ba[--n]=(c&63)|128;ba[--n]=((c>>6)&63)|128;ba[--n]=(c>>12)|224}}}ba[--n]=0;var rng=new SecureRandom();var x=new Array();while(n>2){x[0]=0;while(x[0]==0){rng.nextBytes(x)}ba[--n]=x[0]}ba[--n]=2;ba[--n]=0;return new BigInteger(ba)}function pkcs1pad2Uint8(s,n){if(n<s.length+11){alert("Message too long for RSA");return null
}var ba=new Array();var i=s.length-1;while(i>=0&&n>0){var c=s[i--];ba[--n]=c}ba[--n]=0;var rng=new SecureRandom();var x=new Array();while(n>2){x[0]=0;while(x[0]==0){rng.nextBytes(x)}ba[--n]=x[0]}ba[--n]=2;ba[--n]=0;return new BigInteger(ba)}function RSAKey(){this.n=null;this.e=0;this.d=null;this.p=null;this.q=null;this.dmp1=null;this.dmq1=null;this.coeff=null}function RSASetPublic(N,E){if(N!=null&&E!=null&&N.length>0&&E.length>0){this.n=parseBigInt(N,16);this.e=parseInt(E,16)}else{alert("Invalid RSA public key")}}function RSADoPublic(x){return x.modPowInt(this.e,this.n)}function RSAEncrypt(text){var m=pkcs1pad2(text,(this.n.bitLength()+7)>>3);if(m==null){return null}var c=this.doPublic(m);if(c==null){return null}var h=c.toString(16);if((h.length&1)==0){return h}else{return"0"+h}}function RSAUint8ArrayEncrypt(array){var m=pkcs1pad2Uint8(array,(this.n.bitLength()+7)>>3);if(m==null){return null}var c=this.doPublic(m);if(c==null){return null}var h=c.toString(16);if((h.length&1)==0){return h}else{return"0"+h}}RSAKey.prototype.doPublic=RSADoPublic;RSAKey.prototype.setPublic=RSASetPublic;RSAKey.prototype.encrypt=RSAEncrypt;RSAKey.prototype.encryptUint8=RSAUint8ArrayEncrypt;function aesEncrypt(message,keyHexStr){var key=CryptoJS.enc.Hex.parse(keyHexStr);var encrypted=CryptoJS.AES.encrypt(message,key);return encrypted}function tripleDesEncrypt(message,keyHexStr){var key=CryptoJS.enc.Hex.parse(keyHexStr);var encrypted=CryptoJS.TripleDES.encrypt(message,key,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return encrypted}function tripleDesDecrypt(message,keyHexStr){var key=CryptoJS.enc.Hex.parse(keyHexStr);var decrypted=CryptoJS.TripleDES.decrypt(message,key,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return decrypted}function sha1DigestBase64(message){return Base64.encodeUint8Array(anysign.hex.hexStrToUint8Array(CryptoJS.SHA1(message)+""))}function sha1Digest(message){return CryptoJS.SHA1(message)}function md5Digest(message){return CryptoJS.MD5(message)}var pubN="b0ab856e7331372e214ffb1fdf81dec1713c017e7b85ad08dcf8288df6a37dbea9e856e0ea585da597844c9e2e9013ca6108a2fb4837ff5d5ab32656cf157757bc62a9c55670d29a819a2681be1d8fe69d44c534ed54e4abc8ca9df2a378831c68e4b7573ea79b898f5abb75e0065c1e9500205d3e551fe434884b1f7cec8e8f";
var pubE="10001";var encCertSN="099099000000f14a7f";function rsaPubkeyEnc(pubkeyN,pubkeyE,plainText){var rsa=new RSAKey();rsa.setPublic(pubkeyN,pubkeyE);var res=rsa.encrypt(plainText);var uint8Res=anysign.hex.hexStrToUint8Array(res);return Base64.encodeUint8Array(uint8Res)}function rsaPubkeyUint8Enc(pubkeyN,pubkeyE,uint8Array){var rsa=new RSAKey();rsa.setPublic(pubkeyN,pubkeyE);var res=rsa.encryptUint8(uint8Array);var uint8Res=anysign.hex.hexStrToUint8Array(res);return Base64.encodeUint8Array(uint8Res)}function rsaPubkeyEncByDefault(plainText){return rsaPubkeyEnc(pubN,pubE,plainText)}function rsaPubkeyUint8EncByDefault(uint8Array){return rsaPubkeyUint8Enc(pubN,pubE,uint8Array)};
